{"version":3,"file":"main.nodejs.js","mappings":"qCACA,IAiBQA,EAjBJC,EAAmBC,MAAQA,KAAKD,kBAAqBE,OAAOC,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3B,IAAIG,EAAOP,OAAOQ,yBAAyBL,EAAGC,GACzCG,KAAS,QAASA,GAAQJ,EAAEM,WAAaF,EAAKG,UAAYH,EAAKI,gBAClEJ,EAAO,CAAEK,YAAY,EAAMC,IAAK,WAAa,OAAOV,EAAEC,EAAI,IAE5DJ,OAAOc,eAAeZ,EAAGG,EAAIE,EAChC,EAAI,SAAUL,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,EACb,GACGW,EAAsBhB,MAAQA,KAAKgB,qBAAwBf,OAAOC,OAAS,SAAUC,EAAGc,GACxFhB,OAAOc,eAAeZ,EAAG,UAAW,CAAEU,YAAY,EAAMK,MAAOD,GAClE,EAAI,SAASd,EAAGc,GACbd,EAAW,QAAIc,CACnB,GACIE,EAAgBnB,MAAQA,KAAKmB,eACzBrB,EAAU,SAASK,GAMnB,OALAL,EAAUG,OAAOmB,qBAAuB,SAAUjB,GAC9C,IAAIkB,EAAK,GACT,IAAK,IAAIhB,KAAKF,EAAOF,OAAOqB,UAAUC,eAAeC,KAAKrB,EAAGE,KAAIgB,EAAGA,EAAGI,QAAUpB,GACjF,OAAOgB,CACX,EACOvB,EAAQK,EACnB,EACO,SAAUuB,GACb,GAAIA,GAAOA,EAAIhB,WAAY,OAAOgB,EAClC,IAAIC,EAAS,CAAC,EACd,GAAW,MAAPD,EAAa,IAAK,IAAIrB,EAAIP,EAAQ4B,GAAME,EAAI,EAAGA,EAAIvB,EAAEoB,OAAQG,IAAkB,YAATvB,EAAEuB,IAAkB7B,EAAgB4B,EAAQD,EAAKrB,EAAEuB,IAE7H,OADAZ,EAAmBW,EAAQD,GACpBC,CACX,GAEJ1B,OAAOc,eAAec,EAAS,aAAc,CAAEX,OAAO,IACtDW,EAAQC,gBAAkB,EAC1B,MAAMC,EAAMZ,EAAa,EAAQ,MAC3Ba,EAASb,EAAa,EAAQ,MAE9Bc,EAAgB,CAClBC,OAAOC,KAAK,CAAC,IAAM,IACnBD,OAAOC,KAAK,CAAC,IAAM,IACnBD,OAAOC,KAAK,CAAC,IAAM,IACnBD,OAAOC,KAAK,CAAC,IAAM,IACnBD,OAAOC,KAAK,CAAC,IAAM,IACnBD,OAAOC,KAAK,CAAC,IAAM,IACnBD,OAAOC,KAAK,CAAC,IAAM,IACnBD,OAAOC,KAAK,CAAC,IAAM,KAEvB,SAASC,EAAcC,GACnB,GAAIA,EAAKZ,OAAS,EACd,OAAO,EACX,MAAMa,EAASD,EAAKE,SAAS,EAAG,GAChC,OAAON,EAAcO,KAAKC,GAAKA,EAAEC,OAAOJ,GAC5C,CACA,SAASK,EAAIzB,EAAO0B,GAAY,GAC5B,MAAMC,EAAMX,OAAOY,MAAM,GAOzB,OANIF,EACAC,EAAIE,cAAc7B,GAGlB2B,EAAIG,cAAc9B,GAEf2B,CACX,CAOA,SAASI,EAAI/B,EAAO0B,GAAY,GAC5B,MAAMC,EAAMX,OAAOY,MAAM,GAOzB,OANIF,EACAC,EAAIK,iBAAiBhC,GAGrB2B,EAAIM,iBAAiBjC,GAElB2B,CACX,CA+TAhB,EAAQC,WA9TR,MACI,WAAAsB,CAAYC,GACRrD,KAAKsD,OAAS,KACdtD,KAAKuD,UAAY,EACjBvD,KAAKwD,UAAY,EACjBxD,KAAKyD,SAAU,EACfzD,KAAK0D,kBAAoB,KACzB1D,KAAK2D,OAASzB,OAAOY,MAAM,GAC3B9C,KAAK4D,iBAAmB,IAAIC,IAC5B7D,KAAK8D,KAAOT,EAAQS,KACpB9D,KAAK+D,KAAOV,EAAQU,MAAQ,MAC5B/D,KAAKgE,SAAWX,EAAQW,SACxBhE,KAAKiE,SAAWZ,EAAQY,SACxBjE,KAAKkE,QAAUb,EAAQa,SAAWA,OACtC,CACA,aAAAC,CAAcF,GACV,MAAMG,EAAMpC,EAAOqC,WAAW,OAC9BD,EAAIE,OAAOL,EAAU,UACrB,MAAMM,EAASH,EAAIG,SACbC,EAAM,GACZ,IAAK,IAAI5C,EAAI,EAAGA,EAAI2C,EAAO9C,OAAQG,GAAK,EAAG,CACvC,IAAI6C,GAAOF,EAAO3C,GAAK2C,EAAO3C,EAAI,IAAM,GAEpC6C,GADAA,EAAM,GACC,GAEFA,EAAM,GACJ,GAGA,GAEXD,EAAIE,KAAKD,EACb,CACA,OAAOE,OAAOC,gBAAgBJ,EAClC,CACA,gBAAAK,CAAiBC,EAAQC,EAAOf,EAAUC,GAEtC,MAAMe,EAAYhD,EAAOqC,WAAW,OAC/BC,OAAO,GAAGN,KAAYe,KAASd,IAAY,UAC3CM,OAAO,OACPU,cAML,OAJmBjD,EAAOqC,WAAW,OAChCC,OAAO,GAAGN,KAAYc,KAAUE,IAAa,UAC7CT,OAAO,OACPU,aAET,CACA,iBAAAC,CAAkBJ,EAAQd,EAAUC,GAChC,MAAMkB,EAAWnF,KAAKmE,cAAcF,GAKpC,OAJmBjC,EAAOqC,WAAW,OAChCC,OAAO,GAAGN,KAAYc,KAAUK,IAAY,UAC5CZ,OAAO,OACPU,aAET,CACA,kBAAAG,CAAmBN,EAAQC,EAAOf,EAAUC,GAGxC,MAAO,GAAGD,MAFGhE,KAAK6E,iBAAiBC,EAAQC,EAAOf,EAAUC,KAC/CjE,KAAKkF,kBAAkBJ,EAAQd,EAAUC,IAE1D,CACA,aAAMoB,GACF,OAAO,IAAIC,QAAQ,CAACC,EAASC,KACzBxF,KAAKsD,OAAS,IAAIvB,EAAI0D,OACtBzF,KAAKsD,OAAOoC,WAAW,KACvB1F,KAAKsD,OAAOqC,GAAG,UAAW,KACtB3F,KAAKyD,SAAU,EACfzD,KAAKkE,QAAQ0B,IAAI,wBAAwB5F,KAAK8D,QAAQ9D,KAAK+D,QAC3DwB,MAEJvF,KAAKsD,OAAOqC,GAAG,QAAUE,IACrB7F,KAAKkE,QAAQ4B,MAAM,yBAAyBD,EAAIE,WAChDP,EAAOK,KAEX7F,KAAKsD,OAAOqC,GAAG,UAAW,KACtB3F,KAAKkE,QAAQ4B,MAAM,0BACnB9F,KAAKsD,QAAQ0C,UACbR,EAAO,IAAIS,MAAM,yBAErBjG,KAAKsD,OAAOqC,GAAG,OAAStD,IACpBrC,KAAKkG,WAAW7D,KAEpBrC,KAAKsD,OAAOqC,GAAG,QAAS,KACpB3F,KAAKyD,SAAU,EACfzD,KAAKkE,QAAQ0B,IAAI,+BAErB5F,KAAKsD,OAAO+B,QAAQrF,KAAK+D,KAAM/D,KAAK8D,OAE5C,CACA,UAAAoC,CAAW7D,GACPrC,KAAK2D,OAASzB,OAAOiE,OAAO,CAACnG,KAAK2D,OAAQtB,IAC1CrC,KAAKoG,eACT,CACA,aAAAA,GACI,KAAOpG,KAAK2D,OAAOlC,QAAU,IACzB,GAAIW,EAAcpC,KAAK2D,QAAS,CAE5B,MACM0C,EAAW,GADDrG,KAAK2D,OAAO2C,aAAa,GAEzC,KAAItG,KAAK2D,OAAOlC,QAAU4E,GAMtB,MANgC,CAChC,MAAME,EAASvG,KAAK2D,OAAOpB,SAAS,EAAG8D,GACvCrG,KAAK2D,OAAS3D,KAAK2D,OAAOpB,SAAS8D,GACnCrG,KAAKwG,aAAaD,EACtB,CAIJ,KACK,CAED,IAAIE,GAAQ,EACZ,IAAK,IAAI7E,EAAI,EAAGA,EAAI5B,KAAK2D,OAAOlC,OAAS,EAAGG,IAAK,CAC7C,MAAMU,EAAStC,KAAK2D,OAAOpB,SAASX,EAAGA,EAAI,GAC3C,GAAIK,EAAcO,KAAKC,GAAKA,EAAEC,OAAOJ,IAAU,CAC3CtC,KAAK2D,OAAS3D,KAAK2D,OAAOpB,SAASX,GACnC6E,GAAQ,EACR,KACJ,CACJ,CACA,IAAKA,EAAO,CACRzG,KAAK2D,OAAS3D,KAAK2D,OAAOpB,UAAU,GACpC,KACJ,CACJ,CAER,CACA,YAAAiE,CAAaD,GACT,MAAMG,EAASH,EAAOhE,SAAS,EAAG,IAC5BF,EAAOkE,EAAOhE,SAAS,IAE7B,IAAkB,MAAdmE,EAAO,IAA6B,MAAdA,EAAO,KACzBrE,EAAKZ,OAAS,EACd,IACI,MAAMkF,EAAOtE,EAAKuE,SAAS,UACrBC,EAAYF,EAAKG,QAAQ,KACzBC,EAAUJ,EAAKK,YAAY,KAAO,EACxC,GAAIH,GAAa,GAAKE,EAAUF,EAAW,CACvC,MAAMI,EAAWC,KAAKC,MAAMR,EAAKS,UAAUP,EAAWE,IAChDM,EAAKJ,EAASI,GACpB,GAAIA,GAAMrH,KAAK4D,iBAAiB0D,IAAID,GAAK,CACrC,MAAME,EAAWvH,KAAK4D,iBAAiB9C,IAAIuG,GAC3CrH,KAAK4D,iBAAiB4D,OAAOH,GAC7BE,EAAShC,QAAQ0B,EACrB,CACJ,CACJ,CACA,MAAOQ,GAEP,CAGZ,CACA,WAAMC,GACF,IAAK1H,KAAKsD,OACN,MAAM,IAAI2C,MAAM,iBAGpB,MAAM0B,EAAazF,OAAOC,KAAK,CAC3B,IAAM,EAAM,EAAM,EAClB,EAAM,EAAM,EAAM,EAClB,EAAM,EAAM,EAAM,EAClB,EAAM,EAAM,EAAM,EAClB,EAAM,EAAM,EAAM,EAClB,EAAM,EAAM,EAAM,EAClB,EAAM,EAAM,EAAM,EAClB,EAAM,EAAM,IAAM,MAEtBnC,KAAKkE,QAAQ0B,IAAI,oCACjB5F,KAAKsD,OAAOsE,MAAMD,GAElB,MAAME,QAAsB7H,KAAK8H,YAAY,KAC7C,IAAKD,GAAiBA,EAAcpG,OAAS,GAEzC,OADAzB,KAAKkE,QAAQ4B,MAAM,kCACZ,EAEX,MAAMiC,EAAeF,EAActF,SAAS,IAAIqE,SAAS,UACzD,IAAI7B,EAAQ,KACRD,EAAS,KACb,IAAK,MAAMkD,KAAQD,EAAaE,MAAM,MAC9BD,EAAKE,WAAW,UAChBnD,EAAQiD,EAAKZ,UAAU,GAAGe,OAErBH,EAAKE,WAAW,aACrBpD,EAASkD,EAAKZ,UAAU,GAAGe,QAGnC,IAAKpD,IAAUD,EAEX,OADA9E,KAAKkE,QAAQ4B,MAAM,sCACZ,EAEX9F,KAAKkE,QAAQ0B,IAAI,kBAAkBb,cAAkBD,KAErD,MAAMsD,EAAapI,KAAKoF,mBAAmBN,EAAQC,EAAO/E,KAAKgE,SAAUhE,KAAKiE,UACxEoE,EAAWnG,OAAOC,KAAKiG,EAAY,UACnCE,EAAapG,OAAOiE,OAAO,CAC7BxD,EAAI,YAAY,GAChBA,EAAI0F,EAAS5G,QACbS,OAAOY,MAAM,IACbG,EAAI,qBAAqB,KAE7BjD,KAAKkE,QAAQ0B,IAAI,qCACjB5F,KAAKsD,OAAOsE,MAAM1F,OAAOiE,OAAO,CAACmC,EAAYD,KAE7C,MAAME,QAAqBvI,KAAK8H,YAAY,KAC5C,IAAKS,GAAgBA,EAAa9G,OAAS,GAEvC,OADAzB,KAAKkE,QAAQ4B,MAAM,6BACZ,EAEX,MAAM0C,EAAYD,EAAahG,SAAS,EAAG,IAC3C,OAAqB,IAAjBiG,EAAU,IAAgC,IAAjBA,EAAU,IACnCxI,KAAKuD,UAAYgF,EAAajC,aAAa,IAC3CtG,KAAKkE,QAAQ0B,IAAI,yCAAyC5F,KAAKuD,aAC/DvD,KAAKyI,kBACE,IAEXzI,KAAKkE,QAAQ4B,MAAM,yCAAyC0C,EAAU5B,SAAS,WACxE,EACX,CACA,WAAAkB,CAAYY,GACR,OAAO,IAAIpD,QAASC,IAChB,MAAMoD,EAAc3I,KAAK2D,OAAOlC,OAChC,IAAImH,EAAU,EACd,MAAMC,EAAWC,YAAY,KAEzB,GADAF,GAAW,IACP5I,KAAK2D,OAAOlC,OAASkH,EAAc,GAAI,CACvCI,cAAcF,GACd,MAAMxG,EAAOrC,KAAK2D,OAClB3D,KAAK2D,OAASzB,OAAOY,MAAM,GAC3ByC,EAAQlD,EACZ,MACSuG,GAAWF,IAChBK,cAAcF,GACdtD,EAAQvF,KAAK2D,OAAOlC,OAAS,EAAIzB,KAAK2D,OAAS,MAC/C3D,KAAK2D,OAASzB,OAAOY,MAAM,KAEhC,MAEX,CACA,cAAA2F,GACIzI,KAAK0D,kBAAoBoF,YAAY,KAC7B9I,KAAKyD,SACLzD,KAAKgJ,YAAY,mBAAoB,CAAEC,QAAS,GAAIC,QAAQ,IACvDC,MAAMtD,GAAO7F,KAAKkE,QAAQ4B,MAAM,2BAA4BD,EAAIE,WAE1E,KACP,CACA,iBAAMiD,CAAYI,EAAQC,EAAS,CAAC,GAChC,IAAKrJ,KAAKsD,SAAWtD,KAAKyD,QACtB,MAAM,IAAIwC,MAAM,iBAEpBjG,KAAKwD,YACL,MAAM8F,EAAU,CACZF,SACAC,SACAhC,GAAIrH,KAAKwD,UACT+F,QAASvJ,KAAKuD,WAEZ0D,EAAW/E,OAAOC,KAAK+E,KAAKsC,UAAUF,GAAU,UAChD5C,EAASxE,OAAOiE,OAAO,CACzBxD,EAAI,YAAY,GAChBA,EAAIsE,EAASxF,QACbkB,EAAI3C,KAAKwD,WACTb,EAAI,GACJA,EAAIsE,EAASxF,QACbkB,EAAI,GACJA,EAAI3C,KAAKuD,WACTZ,EAAI,KAER,OAAO,IAAI2C,QAAQ,CAACC,EAASC,KACzB,MAAMyD,EAAUvD,WAAW,KACvB1F,KAAK4D,iBAAiB4D,OAAOxH,KAAKwD,WAClCgC,EAAO,IAAIS,MAAM,oBAAoBmD,OACtC,KACHpJ,KAAK4D,iBAAiB6F,IAAIzJ,KAAKwD,UAAW,CACtC+B,QAAUlD,IACNqH,aAAaT,GACb1D,EAAQlD,IAEZmD,OAASK,IACL6D,aAAaT,GACbzD,EAAOK,MAGf7F,KAAKsD,OAAOsE,MAAM1F,OAAOiE,OAAO,CAACO,EAAQO,MAEjD,CACA,gBAAM0C,CAAWC,EAAWC,EAAQ,EAAGC,EAAS,SAC5C,MAAMT,EAAS,CACXU,QAAS,EACTC,KAAMJ,EACNK,KAAiB,UAAXH,EAAqBD,EAAQ,EACnCK,KAAiB,UAAXJ,EAAqBD,EAAQ,EACnCM,KAAM,EACNC,KAAM,GAEJhB,EAAoB,UAAXU,EAAqB,YAAc,WAClD,OAAO9J,KAAKgJ,YAAYI,EAAQC,EACpC,CACA,aAAMgB,CAAQT,EAAWC,EAAQ,EAAGS,EAAa,WACvCtK,KAAK2J,WAAWC,EAAWC,EAAO,eAClC,IAAIvE,QAAQC,GAAWG,WAAWH,EAAS+E,UAC3CtK,KAAK2J,WAAWC,EAAW,EAAG,OACxC,CACA,UAAAW,GACIvK,KAAKyD,SAAU,EACXzD,KAAK0D,oBACLqF,cAAc/I,KAAK0D,mBACnB1D,KAAK0D,kBAAoB,MAEzB1D,KAAKsD,SACLtD,KAAKsD,OAAO0C,UACZhG,KAAKsD,OAAS,KAEtB,CACA,WAAAkH,GACI,OAAOxK,KAAKyD,SAA2B,OAAhBzD,KAAKsD,MAChC,E,SC7YJmH,EAAO5I,QAAU6I,QAAQ,M,SCAzBD,EAAO5I,QAAU6I,QAAQ,gB,aCCzB,IAiBQ5K,EAjBJC,EAAmBC,MAAQA,KAAKD,kBAAqBE,OAAOC,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3B,IAAIG,EAAOP,OAAOQ,yBAAyBL,EAAGC,GACzCG,KAAS,QAASA,GAAQJ,EAAEM,WAAaF,EAAKG,UAAYH,EAAKI,gBAClEJ,EAAO,CAAEK,YAAY,EAAMC,IAAK,WAAa,OAAOV,EAAEC,EAAI,IAE5DJ,OAAOc,eAAeZ,EAAGG,EAAIE,EAChC,EAAI,SAAUL,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,EACb,GACGW,EAAsBhB,MAAQA,KAAKgB,qBAAwBf,OAAOC,OAAS,SAAUC,EAAGc,GACxFhB,OAAOc,eAAeZ,EAAG,UAAW,CAAEU,YAAY,EAAMK,MAAOD,GAClE,EAAI,SAASd,EAAGc,GACbd,EAAW,QAAIc,CACnB,GACIE,EAAgBnB,MAAQA,KAAKmB,eACzBrB,EAAU,SAASK,GAMnB,OALAL,EAAUG,OAAOmB,qBAAuB,SAAUjB,GAC9C,IAAIkB,EAAK,GACT,IAAK,IAAIhB,KAAKF,EAAOF,OAAOqB,UAAUC,eAAeC,KAAKrB,EAAGE,KAAIgB,EAAGA,EAAGI,QAAUpB,GACjF,OAAOgB,CACX,EACOvB,EAAQK,EACnB,EACO,SAAUuB,GACb,GAAIA,GAAOA,EAAIhB,WAAY,OAAOgB,EAClC,IAAIC,EAAS,CAAC,EACd,GAAW,MAAPD,EAAa,IAAK,IAAIrB,EAAIP,EAAQ4B,GAAME,EAAI,EAAGA,EAAIvB,EAAEoB,OAAQG,IAAkB,YAATvB,EAAEuB,IAAkB7B,EAAgB4B,EAAQD,EAAKrB,EAAEuB,IAE7H,OADAZ,EAAmBW,EAAQD,GACpBC,CACX,GAEJ1B,OAAOc,eAAec,EAAS,aAAc,CAAEX,OAAO,IACtD,MAAMyJ,EAAQxJ,EAAa,EAAQ,MAC7ByJ,EAAU,EAAQ,MAClB,cAAEC,EAAa,aAAEC,GAAiBH,EAAMI,QAC9C,MAAMC,UAA2BL,EAAMM,mBACnC,WAAA7H,CAAY8H,GACRC,MAAMD,GACNlL,KAAKoL,MAAQ,KACbpL,KAAKqL,gBAAkB,KAEvBrL,KAAKsL,gBAAkB,CACnBC,KAAK,EACLC,MAAM,EACNC,MAAM,EAEd,CACA,OAAAC,GACI,OAAO1L,KAAK2L,QAAQC,QAAQ,SAAW,EAC3C,CACA,WAAAC,GACI,OAAO7L,KAAK2L,QAAQC,QAAQ,aAAe,OAC/C,CACA,WAAAE,GACI,OAAO9L,KAAK2L,QAAQC,QAAQ,aAAe,EAC/C,CACA,WAAAG,GACI,OAAOC,SAAShM,KAAK2L,QAAQC,QAAQ,aAAe,MACxD,CACA,YAAAK,GACI,OAAOD,SAAShM,KAAK2L,QAAQC,QAAQ,cAAgB,QACzD,CACA,UAAAM,CAAWC,EAAU,GACjB,MAAMrI,EAAO9D,KAAK0L,UAIlB,MAAO,UAHUU,mBAAmBpM,KAAK6L,kBACxBO,mBAAmBpM,KAAK8L,kBAEAhI,KAD5B9D,KAAK+L,mDACyEI,GAC/F,CACA,iBAAME,GACF,MAAO,CACH,CACIC,IAAK,OACLC,MAAO,oBACPrL,MAAOlB,KAAK0L,UACZc,KAAM,SACNC,YAAa,iBAEjB,CACIH,IAAK,WACLC,MAAO,WACPrL,MAAOlB,KAAK6L,cACZW,KAAM,UAEV,CACIF,IAAK,WACLC,MAAO,WACPrL,MAAOlB,KAAK8L,cACZU,KAAM,YAEV,CACIF,IAAK,WACLC,MAAO,YACPrL,MAAOlB,KAAK+L,cAAcnF,WAC1B4F,KAAM,SACNC,YAAa,OAEjB,CACIH,IAAK,YACLC,MAAO,uBACPrL,MAAOlB,KAAKiM,eAAerF,WAC3B4F,KAAM,SACNC,YAAa,SAGzB,CACA,gBAAMC,CAAWJ,EAAKpL,GAClBlB,KAAK2L,QAAQgB,QAAQL,EAAc,MAATpL,EAAgByD,OAAOzD,GAAS,IAEtDlB,KAAKoL,QACLpL,KAAKoL,MAAMb,aACXvK,KAAKoL,MAAQ,KAErB,CACA,0BAAMwB,GACF,GAAI5M,KAAKoL,OAAOZ,cACZ,OAAOxK,KAAKoL,MAEhB,GAAIpL,KAAKqL,wBACCrL,KAAKqL,gBACPrL,KAAKoL,OAAOZ,eACZ,OAAOxK,KAAKoL,MAGpBpL,KAAKqL,gBAAkB,WACnB,MAAMvH,EAAO9D,KAAK0L,UAClB,IAAK5H,EACD,MAAM,IAAImC,MAAM,4BAEpBjG,KAAKoL,MAAQ,IAAIR,EAAQ9I,WAAW,CAChCgC,OACAC,KAAM/D,KAAKiM,eACXjI,SAAUhE,KAAK6L,cACf5H,SAAUjE,KAAK8L,cACf5H,QAASlE,KAAKkE,UAElB,IAGI,aAFMlE,KAAKoL,MAAM/F,gBACKrF,KAAKoL,MAAM1D,OAErC,CACA,MAAOD,GAGH,MAFAzH,KAAKoL,MAAMb,aACXvK,KAAKoL,MAAQ,KACP3D,CACV,CACH,EAtBsB,GAuBvB,MAAMoF,QAAgB7M,KAAKqL,gBAE3B,GADArL,KAAKqL,gBAAkB,MAClBwB,EACD,MAAM,IAAI5G,MAAM,sBAEpB,OAAOjG,KAAKoL,KAChB,CAEA,oBAAM0B,CAAezJ,GACjB,MAAM8I,EAA0B,cAAhB9I,GAASgE,GAAqB,EAAI,EAC5C0F,EAAU/M,KAAKkM,WAAWC,GAC1Ba,EAAc,CAChBC,IAAKF,EACLG,eAAgB,CACZ,kBAAmB,MACnB,KAAMH,IAGd,OAAOjC,EAAaqC,wBAAwBH,EAChD,CACA,2BAAMI,GACF,MAAO,CACH,CACI/F,GAAI,aACJgG,KAAM,cACNC,MAAO,CACHC,MAAO,QAEXC,MAAO,CACHD,MAAO,QAGf,CACIlG,GAAI,YACJgG,KAAM,aACNC,MAAO,CACHC,MAAO,QAEXC,MAAO,CACHD,MAAO,QAIvB,CAEA,iBAAME,CAAYpK,GAEd,MAAM0J,EAAU/M,KAAKkM,WAAW,GAC1Bc,EAAc,CAChBC,IAAKF,EACLG,eAAgB,CACZ,kBAAmB,MACnB,KAAMH,EACN,YAAa,IACb,KAAM,WAGd,OAAOjC,EAAaqC,wBAAwBH,EAChD,CACA,uBAAMU,GACF,MAAO,EACX,CAEA,gBAAMC,CAAWrE,GACb,MAAM8B,QAAcpL,KAAK4M,uBAGnBgB,EAAY1M,QACAX,IAAVW,EACO,EACJ2M,KAAKC,IAAI,EAAGD,KAAKE,IAAI,EAAGF,KAAKG,KAAuB,EAAlBH,KAAKI,IAAI/M,MAEhDqK,EAAMjC,EAAQiC,IACdC,EAAOlC,EAAQkC,KACfC,EAAOnC,EAAQmC,KACrB,IAEI,QAAYlL,IAARgL,GAA6B,IAARA,EAAW,CAChC,MAAM3B,EAAY2B,EAAM,EAAI,QAAU,OAChC1B,EAAQ+D,EAASrC,SACjBH,EAAMzB,WAAWC,EAAWC,EAAO,SAEzCnE,WAAWwI,UACP,UACU9C,EAAMzB,WAAWC,EAAW,EAAG,OACzC,CACA,MAAOnC,GAEP,GACD,IACP,CAEA,QAAalH,IAATiL,GAA+B,IAATA,EAAY,CAClC,MAAM5B,EAAY4B,EAAO,EAAI,KAAO,OAC9B3B,EAAQ+D,EAASpC,SACjBJ,EAAMzB,WAAWC,EAAWC,EAAO,SACzCnE,WAAWwI,UACP,UACU9C,EAAMzB,WAAWC,EAAW,EAAG,OACzC,CACA,MAAOnC,GAEP,GACD,IACP,CAEA,QAAalH,IAATkL,GAA+B,IAATA,EAAY,CAClC,MAAM7B,EAAY6B,EAAO,EAAI,SAAW,UAClC5B,EAAQ+D,EAASnC,SACjBL,EAAMzB,WAAWC,EAAWC,EAAO,SACzCnE,WAAWwI,UACP,UACU9C,EAAMzB,WAAWC,EAAW,EAAG,OACzC,CACA,MAAOnC,GAEP,GACD,IACP,CACJ,CACA,MAAOA,GAEH,MADAzH,KAAKkE,QAAQ4B,MAAM,qBAAsB2B,EAAE1B,SACrC0B,CACV,CACJ,EAEJ,MAAM0G,UAA6BxD,EAAMM,mBACrC,WAAA7H,CAAY8H,GACRC,MAAMD,GACNlL,KAAKoO,QAAU,IAAIvK,GACvB,CACA,iBAAMwI,GACF,MAAO,CACH,CACIC,IAAK,YACLC,MAAO,aACP8B,YAAa,gEACb7B,KAAM,SACNC,YAAa,iBAGzB,CACA,gBAAMC,CAAWJ,EAAKpL,GAClB,GAAY,cAARoL,GAAuBpL,EAAO,CAC9B,MAAMoN,EAAK3J,OAAOzD,SACZlB,KAAKuO,UAAUD,EACzB,CACJ,CACA,eAAMC,CAAUD,GACZ,MAAMpD,EAAW,iBAAiBoD,EAAGE,QAAQ,MAAO,aAC9C3D,EAAc4D,mBAAmB,CACnCvD,WACAmC,KAAM,kBAAkBiB,KACxB9B,KAAM7B,EAAM+D,mBAAmBC,OAC/BC,WAAY,CACRjE,EAAMkE,kBAAkBF,OACxBhE,EAAMkE,kBAAkBC,YACxBnE,EAAMkE,kBAAkBE,YACxBpE,EAAMkE,kBAAkBG,YAIhC,MAAMC,QAAejP,KAAKkP,UAAUhE,GAChC+D,GAAUA,EAAOtD,SACjBsD,EAAOtD,QAAQgB,QAAQ,OAAQ2B,EAEvC,CACA,eAAMY,CAAUhE,GACZ,IAAIiE,EAASnP,KAAKoO,QAAQtN,IAAIoK,GAK9B,OAJKiE,IACDA,EAAS,IAAInE,EAAmBE,GAChClL,KAAKoO,QAAQ3E,IAAIyB,EAAUiE,IAExBA,CACX,CACA,mBAAMC,CAAc/H,EAAI6D,GACLlL,KAAKoO,QAAQtN,IAAIoK,IAE5BlL,KAAKoO,QAAQ5G,OAAO0D,EAE5B,EAEJrJ,EAAA,QAAkB,IAAIsM,C,SC5UtB1D,EAAO5I,QAAU6I,QAAQ,S,GCCrB2E,EAA2B,CAAC,ECE5BC,EDCJ,SAASC,EAAoBC,GAE5B,IAAIC,EAAeJ,EAAyBG,GAC5C,QAAqBjP,IAAjBkP,EACH,OAAOA,EAAa5N,QAGrB,IAAI4I,EAAS4E,EAAyBG,GAAY,CAGjD3N,QAAS,CAAC,GAOX,OAHA6N,EAAoBF,GAAUhO,KAAKiJ,EAAO5I,QAAS4I,EAAQA,EAAO5I,QAAS0N,GAGpE9E,EAAO5I,OACf,CCnB0B0N,CAAoB,K","sources":["webpack://scrypted-amcrest-ash21/./src/dvrip.ts","webpack://scrypted-amcrest-ash21/external node-commonjs \"net\"","webpack://scrypted-amcrest-ash21/external commonjs \"@scrypted/sdk\"","webpack://scrypted-amcrest-ash21/./src/main.ts","webpack://scrypted-amcrest-ash21/external node-commonjs \"crypto\"","webpack://scrypted-amcrest-ash21/webpack/bootstrap","webpack://scrypted-amcrest-ash21/webpack/startup"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DahuaDVRIP = void 0;\nconst net = __importStar(require(\"net\"));\nconst crypto = __importStar(require(\"crypto\"));\n// Valid DVRIP packet prefixes\nconst DVRIP_HEADERS = [\n    Buffer.from([0xa0, 0x00]), // 3DES Login\n    Buffer.from([0xa0, 0x01]), // DVRIP Send Request Realm\n    Buffer.from([0xa0, 0x05]), // DVRIP login Send Login Details\n    Buffer.from([0xb0, 0x00]), // DVRIP Receive\n    Buffer.from([0xb0, 0x01]), // DVRIP Receive\n    Buffer.from([0xa3, 0x01]), // DVRIP Discover Request\n    Buffer.from([0xb3, 0x00]), // DVRIP Discover Response\n    Buffer.from([0xf6, 0x00]), // DVRIP JSON\n];\nfunction isDvripPacket(data) {\n    if (data.length < 2)\n        return false;\n    const prefix = data.subarray(0, 2);\n    return DVRIP_HEADERS.some(h => h.equals(prefix));\n}\nfunction p32(value, bigEndian = false) {\n    const buf = Buffer.alloc(4);\n    if (bigEndian) {\n        buf.writeUInt32BE(value);\n    }\n    else {\n        buf.writeUInt32LE(value);\n    }\n    return buf;\n}\nfunction u32(data, bigEndian = false) {\n    if (bigEndian) {\n        return data.readUInt32BE(0);\n    }\n    return data.readUInt32LE(0);\n}\nfunction p64(value, bigEndian = false) {\n    const buf = Buffer.alloc(8);\n    if (bigEndian) {\n        buf.writeBigUInt64BE(value);\n    }\n    else {\n        buf.writeBigUInt64LE(value);\n    }\n    return buf;\n}\nclass DahuaDVRIP {\n    constructor(options) {\n        this.socket = null;\n        this.sessionId = 0;\n        this.requestId = 0;\n        this.running = false;\n        this.keepaliveInterval = null;\n        this.buffer = Buffer.alloc(0);\n        this.pendingResolvers = new Map();\n        this.host = options.host;\n        this.port = options.port || 37777;\n        this.username = options.username;\n        this.password = options.password;\n        this.console = options.console || console;\n    }\n    dahuaGen1Hash(password) {\n        const md5 = crypto.createHash('md5');\n        md5.update(password, 'latin1');\n        const digest = md5.digest();\n        const out = [];\n        for (let i = 0; i < digest.length; i += 2) {\n            let val = (digest[i] + digest[i + 1]) % 62;\n            if (val < 10) {\n                val += 48; // '0'-'9'\n            }\n            else if (val < 36) {\n                val += 55; // 'A'-'Z'\n            }\n            else {\n                val += 61; // 'a'-'z'\n            }\n            out.push(val);\n        }\n        return String.fromCharCode(...out);\n    }\n    dahuaGen2Md5Hash(random, realm, username, password) {\n        // First hash: username:realm:password\n        const pwddbHash = crypto.createHash('md5')\n            .update(`${username}:${realm}:${password}`, 'latin1')\n            .digest('hex')\n            .toUpperCase();\n        // Second hash: username:random:first_hash\n        const randomHash = crypto.createHash('md5')\n            .update(`${username}:${random}:${pwddbHash}`, 'latin1')\n            .digest('hex')\n            .toUpperCase();\n        return randomHash;\n    }\n    dahuaDvripMd5Hash(random, username, password) {\n        const gen1Hash = this.dahuaGen1Hash(password);\n        const randomHash = crypto.createHash('md5')\n            .update(`${username}:${random}:${gen1Hash}`, 'latin1')\n            .digest('hex')\n            .toUpperCase();\n        return randomHash;\n    }\n    buildDvripAuthHash(random, realm, username, password) {\n        const gen2 = this.dahuaGen2Md5Hash(random, realm, username, password);\n        const gen1 = this.dahuaDvripMd5Hash(random, username, password);\n        return `${username}&&${gen2}${gen1}`;\n    }\n    async connect() {\n        return new Promise((resolve, reject) => {\n            this.socket = new net.Socket();\n            this.socket.setTimeout(10000);\n            this.socket.on('connect', () => {\n                this.running = true;\n                this.console.log(`[DVRIP] Connected to ${this.host}:${this.port}`);\n                resolve();\n            });\n            this.socket.on('error', (err) => {\n                this.console.error(`[DVRIP] Socket error: ${err.message}`);\n                reject(err);\n            });\n            this.socket.on('timeout', () => {\n                this.console.error('[DVRIP] Socket timeout');\n                this.socket?.destroy();\n                reject(new Error('Connection timeout'));\n            });\n            this.socket.on('data', (data) => {\n                this.handleData(data);\n            });\n            this.socket.on('close', () => {\n                this.running = false;\n                this.console.log('[DVRIP] Connection closed');\n            });\n            this.socket.connect(this.port, this.host);\n        });\n    }\n    handleData(data) {\n        this.buffer = Buffer.concat([this.buffer, data]);\n        this.processBuffer();\n    }\n    processBuffer() {\n        while (this.buffer.length >= 32) {\n            if (isDvripPacket(this.buffer)) {\n                // Parse header to get expected data length\n                const dataLen = this.buffer.readUInt32LE(4);\n                const totalLen = 32 + dataLen;\n                if (this.buffer.length >= totalLen) {\n                    const packet = this.buffer.subarray(0, totalLen);\n                    this.buffer = this.buffer.subarray(totalLen);\n                    this.handlePacket(packet);\n                }\n                else {\n                    break; // Need more data\n                }\n            }\n            else {\n                // Not a DVRIP packet - skip bytes until we find one\n                let found = false;\n                for (let i = 1; i < this.buffer.length - 1; i++) {\n                    const prefix = this.buffer.subarray(i, i + 2);\n                    if (DVRIP_HEADERS.some(h => h.equals(prefix))) {\n                        this.buffer = this.buffer.subarray(i);\n                        found = true;\n                        break;\n                    }\n                }\n                if (!found) {\n                    this.buffer = this.buffer.subarray(-1);\n                    break;\n                }\n            }\n        }\n    }\n    handlePacket(packet) {\n        const header = packet.subarray(0, 32);\n        const data = packet.subarray(32);\n        // Check if this is a JSON response\n        if (header[0] === 0xf6 || header[0] === 0xb0) {\n            if (data.length > 0) {\n                try {\n                    const text = data.toString('latin1');\n                    const jsonStart = text.indexOf('{');\n                    const jsonEnd = text.lastIndexOf('}') + 1;\n                    if (jsonStart >= 0 && jsonEnd > jsonStart) {\n                        const jsonData = JSON.parse(text.substring(jsonStart, jsonEnd));\n                        const id = jsonData.id;\n                        if (id && this.pendingResolvers.has(id)) {\n                            const resolver = this.pendingResolvers.get(id);\n                            this.pendingResolvers.delete(id);\n                            resolver.resolve(jsonData);\n                        }\n                    }\n                }\n                catch (e) {\n                    // Not JSON or parse error\n                }\n            }\n        }\n    }\n    async login() {\n        if (!this.socket) {\n            throw new Error('Not connected');\n        }\n        // Step 1: Send realm request\n        const initHeader = Buffer.from([\n            0xa0, 0x01, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x05, 0x02, 0x01, 0x01,\n            0x00, 0x00, 0xa1, 0xaa\n        ]);\n        this.console.log('[DVRIP] Sending login request...');\n        this.socket.write(initHeader);\n        // Wait for challenge response\n        const challengeData = await this.waitForData(5000);\n        if (!challengeData || challengeData.length < 32) {\n            this.console.error('[DVRIP] No challenge response');\n            return false;\n        }\n        const responseText = challengeData.subarray(32).toString('latin1');\n        let realm = null;\n        let random = null;\n        for (const line of responseText.split('\\n')) {\n            if (line.startsWith('Realm:')) {\n                realm = line.substring(6).trim();\n            }\n            else if (line.startsWith('Random:')) {\n                random = line.substring(7).trim();\n            }\n        }\n        if (!realm || !random) {\n            this.console.error('[DVRIP] Failed to parse challenge');\n            return false;\n        }\n        this.console.log(`[DVRIP] Realm: ${realm}, Random: ${random}`);\n        // Step 2: Send authentication\n        const authString = this.buildDvripAuthHash(random, realm, this.username, this.password);\n        const authData = Buffer.from(authString, 'latin1');\n        const authHeader = Buffer.concat([\n            p32(0xa0050000, true),\n            p32(authData.length),\n            Buffer.alloc(16),\n            p64(0x050200080000a1aan, true)\n        ]);\n        this.console.log('[DVRIP] Sending authentication...');\n        this.socket.write(Buffer.concat([authHeader, authData]));\n        // Wait for auth response\n        const authResponse = await this.waitForData(5000);\n        if (!authResponse || authResponse.length < 32) {\n            this.console.error('[DVRIP] No auth response');\n            return false;\n        }\n        const errorCode = authResponse.subarray(8, 10);\n        if (errorCode[0] === 0x00 && errorCode[1] === 0x08) {\n            this.sessionId = authResponse.readUInt32LE(16);\n            this.console.log(`[DVRIP] Login successful! Session ID: ${this.sessionId}`);\n            this.startKeepalive();\n            return true;\n        }\n        this.console.error(`[DVRIP] Login failed with error code: ${errorCode.toString('hex')}`);\n        return false;\n    }\n    waitForData(timeoutMs) {\n        return new Promise((resolve) => {\n            const startBuffer = this.buffer.length;\n            let elapsed = 0;\n            const interval = setInterval(() => {\n                elapsed += 100;\n                if (this.buffer.length > startBuffer + 32) {\n                    clearInterval(interval);\n                    const data = this.buffer;\n                    this.buffer = Buffer.alloc(0);\n                    resolve(data);\n                }\n                else if (elapsed >= timeoutMs) {\n                    clearInterval(interval);\n                    resolve(this.buffer.length > 0 ? this.buffer : null);\n                    this.buffer = Buffer.alloc(0);\n                }\n            }, 100);\n        });\n    }\n    startKeepalive() {\n        this.keepaliveInterval = setInterval(() => {\n            if (this.running) {\n                this.sendCommand('global.keepAlive', { timeout: 30, active: true })\n                    .catch(err => this.console.error('[DVRIP] Keepalive error:', err.message));\n            }\n        }, 25000);\n    }\n    async sendCommand(method, params = {}) {\n        if (!this.socket || !this.running) {\n            throw new Error('Not connected');\n        }\n        this.requestId++;\n        const command = {\n            method,\n            params,\n            id: this.requestId,\n            session: this.sessionId\n        };\n        const jsonData = Buffer.from(JSON.stringify(command), 'latin1');\n        const header = Buffer.concat([\n            p32(0xf6000000, true),\n            p32(jsonData.length),\n            p32(this.requestId),\n            p32(0),\n            p32(jsonData.length),\n            p32(0),\n            p32(this.sessionId),\n            p32(0)\n        ]);\n        return new Promise((resolve, reject) => {\n            const timeout = setTimeout(() => {\n                this.pendingResolvers.delete(this.requestId);\n                reject(new Error(`Command timeout: ${method}`));\n            }, 10000);\n            this.pendingResolvers.set(this.requestId, {\n                resolve: (data) => {\n                    clearTimeout(timeout);\n                    resolve(data);\n                },\n                reject: (err) => {\n                    clearTimeout(timeout);\n                    reject(err);\n                }\n            });\n            this.socket.write(Buffer.concat([header, jsonData]));\n        });\n    }\n    async ptzControl(direction, speed = 5, action = 'start') {\n        const params = {\n            channel: 0,\n            code: direction,\n            arg1: action === 'start' ? speed : 0,\n            arg2: action === 'start' ? speed : 0,\n            arg3: 0,\n            arg4: 0\n        };\n        const method = action === 'start' ? 'ptz.start' : 'ptz.stop';\n        return this.sendCommand(method, params);\n    }\n    async ptzMove(direction, speed = 5, durationMs = 500) {\n        await this.ptzControl(direction, speed, 'start');\n        await new Promise(resolve => setTimeout(resolve, durationMs));\n        await this.ptzControl(direction, 0, 'stop');\n    }\n    disconnect() {\n        this.running = false;\n        if (this.keepaliveInterval) {\n            clearInterval(this.keepaliveInterval);\n            this.keepaliveInterval = null;\n        }\n        if (this.socket) {\n            this.socket.destroy();\n            this.socket = null;\n        }\n    }\n    isConnected() {\n        return this.running && this.socket !== null;\n    }\n}\nexports.DahuaDVRIP = DahuaDVRIP;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHZyaXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZHZyaXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEseUNBQTJCO0FBQzNCLCtDQUFpQztBQUVqQyw4QkFBOEI7QUFDOUIsTUFBTSxhQUFhLEdBQUc7SUFDbEIsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFHLGFBQWE7SUFDekMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFHLDJCQUEyQjtJQUN2RCxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLEVBQUcsaUNBQWlDO0lBQzdELE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsRUFBRyxnQkFBZ0I7SUFDNUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFHLGdCQUFnQjtJQUM1QyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLEVBQUcseUJBQXlCO0lBQ3JELE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsRUFBRywwQkFBMEI7SUFDdEQsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFHLGFBQWE7Q0FDNUMsQ0FBQztBQUVGLFNBQVMsYUFBYSxDQUFDLElBQVk7SUFDL0IsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUM7UUFBRSxPQUFPLEtBQUssQ0FBQztJQUNsQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNuQyxPQUFPLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDckQsQ0FBQztBQUVELFNBQVMsR0FBRyxDQUFDLEtBQWEsRUFBRSxTQUFTLEdBQUcsS0FBSztJQUN6QyxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVCLElBQUksU0FBUyxFQUFFLENBQUM7UUFDWixHQUFHLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLENBQUM7U0FBTSxDQUFDO1FBQ0osR0FBRyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBQ0QsT0FBTyxHQUFHLENBQUM7QUFDZixDQUFDO0FBRUQsU0FBUyxHQUFHLENBQUMsSUFBWSxFQUFFLFNBQVMsR0FBRyxLQUFLO0lBQ3hDLElBQUksU0FBUyxFQUFFLENBQUM7UUFDWixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUNELE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoQyxDQUFDO0FBRUQsU0FBUyxHQUFHLENBQUMsS0FBYSxFQUFFLFNBQVMsR0FBRyxLQUFLO0lBQ3pDLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUIsSUFBSSxTQUFTLEVBQUUsQ0FBQztRQUNaLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNoQyxDQUFDO1NBQU0sQ0FBQztRQUNKLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBQ0QsT0FBTyxHQUFHLENBQUM7QUFDZixDQUFDO0FBVUQsTUFBYSxVQUFVO0lBY25CLFlBQVksT0FBcUI7UUFUekIsV0FBTSxHQUFzQixJQUFJLENBQUM7UUFDakMsY0FBUyxHQUFXLENBQUMsQ0FBQztRQUN0QixjQUFTLEdBQVcsQ0FBQyxDQUFDO1FBQ3RCLFlBQU8sR0FBWSxLQUFLLENBQUM7UUFDekIsc0JBQWlCLEdBQTBCLElBQUksQ0FBQztRQUNoRCxXQUFNLEdBQVcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQyxxQkFBZ0IsR0FBZ0YsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUk5RyxJQUFJLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7UUFDekIsSUFBSSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxJQUFJLEtBQUssQ0FBQztRQUNsQyxJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUM7UUFDakMsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sSUFBSSxPQUFPLENBQUM7SUFDOUMsQ0FBQztJQUVPLGFBQWEsQ0FBQyxRQUFnQjtRQUNsQyxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JDLEdBQUcsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQy9CLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUU1QixNQUFNLEdBQUcsR0FBYSxFQUFFLENBQUM7UUFDekIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ3hDLElBQUksR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDM0MsSUFBSSxHQUFHLEdBQUcsRUFBRSxFQUFFLENBQUM7Z0JBQ1gsR0FBRyxJQUFJLEVBQUUsQ0FBQyxDQUFFLFVBQVU7WUFDMUIsQ0FBQztpQkFBTSxJQUFJLEdBQUcsR0FBRyxFQUFFLEVBQUUsQ0FBQztnQkFDbEIsR0FBRyxJQUFJLEVBQUUsQ0FBQyxDQUFFLFVBQVU7WUFDMUIsQ0FBQztpQkFBTSxDQUFDO2dCQUNKLEdBQUcsSUFBSSxFQUFFLENBQUMsQ0FBRSxVQUFVO1lBQzFCLENBQUM7WUFDRCxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLENBQUM7UUFDRCxPQUFPLE1BQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRU8sZ0JBQWdCLENBQUMsTUFBYyxFQUFFLEtBQWEsRUFBRSxRQUFnQixFQUFFLFFBQWdCO1FBQ3RGLHNDQUFzQztRQUN0QyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQzthQUNyQyxNQUFNLENBQUMsR0FBRyxRQUFRLElBQUksS0FBSyxJQUFJLFFBQVEsRUFBRSxFQUFFLFFBQVEsQ0FBQzthQUNwRCxNQUFNLENBQUMsS0FBSyxDQUFDO2FBQ2IsV0FBVyxFQUFFLENBQUM7UUFFbkIsMENBQTBDO1FBQzFDLE1BQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDO2FBQ3RDLE1BQU0sQ0FBQyxHQUFHLFFBQVEsSUFBSSxNQUFNLElBQUksU0FBUyxFQUFFLEVBQUUsUUFBUSxDQUFDO2FBQ3RELE1BQU0sQ0FBQyxLQUFLLENBQUM7YUFDYixXQUFXLEVBQUUsQ0FBQztRQUVuQixPQUFPLFVBQVUsQ0FBQztJQUN0QixDQUFDO0lBRU8saUJBQWlCLENBQUMsTUFBYyxFQUFFLFFBQWdCLEVBQUUsUUFBZ0I7UUFDeEUsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5QyxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQzthQUN0QyxNQUFNLENBQUMsR0FBRyxRQUFRLElBQUksTUFBTSxJQUFJLFFBQVEsRUFBRSxFQUFFLFFBQVEsQ0FBQzthQUNyRCxNQUFNLENBQUMsS0FBSyxDQUFDO2FBQ2IsV0FBVyxFQUFFLENBQUM7UUFDbkIsT0FBTyxVQUFVLENBQUM7SUFDdEIsQ0FBQztJQUVPLGtCQUFrQixDQUFDLE1BQWMsRUFBRSxLQUFhLEVBQUUsUUFBZ0IsRUFBRSxRQUFnQjtRQUN4RixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDdEUsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDaEUsT0FBTyxHQUFHLFFBQVEsS0FBSyxJQUFJLEdBQUcsSUFBSSxFQUFFLENBQUM7SUFDekMsQ0FBQztJQUVELEtBQUssQ0FBQyxPQUFPO1FBQ1QsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUNuQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQy9CLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRTlCLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7Z0JBQzNCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO2dCQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDbkUsT0FBTyxFQUFFLENBQUM7WUFDZCxDQUFDLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFO2dCQUM1QixJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7Z0JBQzNELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNoQixDQUFDLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7Z0JBQzNCLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUM7Z0JBQzdDLElBQUksQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUM7Z0JBQ3ZCLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFDNUMsQ0FBQyxDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRTtnQkFDNUIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMxQixDQUFDLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUU7Z0JBQ3pCLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO2dCQUNyQixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1lBQ2xELENBQUMsQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRU8sVUFBVSxDQUFDLElBQVk7UUFDM0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2pELElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRU8sYUFBYTtRQUNqQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLEVBQUUsRUFBRSxDQUFDO1lBQzlCLElBQUksYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO2dCQUM3QiwyQ0FBMkM7Z0JBQzNDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM1QyxNQUFNLFFBQVEsR0FBRyxFQUFFLEdBQUcsT0FBTyxDQUFDO2dCQUU5QixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLFFBQVEsRUFBRSxDQUFDO29CQUNqQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBQ2pELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBQzdDLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzlCLENBQUM7cUJBQU0sQ0FBQztvQkFDSixNQUFNLENBQUUsaUJBQWlCO2dCQUM3QixDQUFDO1lBQ0wsQ0FBQztpQkFBTSxDQUFDO2dCQUNKLG9EQUFvRDtnQkFDcEQsSUFBSSxLQUFLLEdBQUcsS0FBSyxDQUFDO2dCQUNsQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQzlDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQzlDLElBQUksYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDO3dCQUM1QyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUN0QyxLQUFLLEdBQUcsSUFBSSxDQUFDO3dCQUNiLE1BQU07b0JBQ1YsQ0FBQztnQkFDTCxDQUFDO2dCQUNELElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztvQkFDVCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3ZDLE1BQU07Z0JBQ1YsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQztJQUVPLFlBQVksQ0FBQyxNQUFjO1FBQy9CLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFakMsbUNBQW1DO1FBQ25DLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUM7WUFDM0MsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNsQixJQUFJLENBQUM7b0JBQ0QsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDckMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDcEMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQzFDLElBQUksU0FBUyxJQUFJLENBQUMsSUFBSSxPQUFPLEdBQUcsU0FBUyxFQUFFLENBQUM7d0JBQ3hDLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQzt3QkFDaEUsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLEVBQUUsQ0FBQzt3QkFDdkIsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDOzRCQUN0QyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBRSxDQUFDOzRCQUNoRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDOzRCQUNqQyxRQUFRLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUMvQixDQUFDO29CQUNMLENBQUM7Z0JBQ0wsQ0FBQztnQkFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO29CQUNULDBCQUEwQjtnQkFDOUIsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxLQUFLO1FBQ1AsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNmLE1BQU0sSUFBSSxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDckMsQ0FBQztRQUVELDZCQUE2QjtRQUM3QixNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQzNCLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDdEIsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtZQUN0QixJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO1lBQ3RCLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDdEIsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtZQUN0QixJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO1lBQ3RCLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDdEIsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtTQUN6QixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTlCLDhCQUE4QjtRQUM5QixNQUFNLGFBQWEsR0FBRyxNQUFNLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLGFBQWEsSUFBSSxhQUFhLENBQUMsTUFBTSxHQUFHLEVBQUUsRUFBRSxDQUFDO1lBQzlDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLCtCQUErQixDQUFDLENBQUM7WUFDcEQsT0FBTyxLQUFLLENBQUM7UUFDakIsQ0FBQztRQUVELE1BQU0sWUFBWSxHQUFHLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ25FLElBQUksS0FBSyxHQUFrQixJQUFJLENBQUM7UUFDaEMsSUFBSSxNQUFNLEdBQWtCLElBQUksQ0FBQztRQUVqQyxLQUFLLE1BQU0sSUFBSSxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUMxQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztnQkFDNUIsS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDckMsQ0FBQztpQkFBTSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQztnQkFDcEMsTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDdEMsQ0FBQztRQUNMLENBQUM7UUFFRCxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDcEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsbUNBQW1DLENBQUMsQ0FBQztZQUN4RCxPQUFPLEtBQUssQ0FBQztRQUNqQixDQUFDO1FBRUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEtBQUssYUFBYSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBRS9ELDhCQUE4QjtRQUM5QixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN4RixNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUVuRCxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQzdCLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDO1lBQ3JCLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO1lBQ3BCLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ2hCLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUM7U0FDakMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUNBQW1DLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV6RCx5QkFBeUI7UUFDekIsTUFBTSxZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxZQUFZLElBQUksWUFBWSxDQUFDLE1BQU0sR0FBRyxFQUFFLEVBQUUsQ0FBQztZQUM1QyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1lBQy9DLE9BQU8sS0FBSyxDQUFDO1FBQ2pCLENBQUM7UUFFRCxNQUFNLFNBQVMsR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMvQyxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDO1lBQ2pELElBQUksQ0FBQyxTQUFTLEdBQUcsWUFBWSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMvQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5Q0FBeUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7WUFDNUUsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3RCLE9BQU8sSUFBSSxDQUFDO1FBQ2hCLENBQUM7UUFFRCxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyx5Q0FBeUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDekYsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVPLFdBQVcsQ0FBQyxTQUFpQjtRQUNqQyxPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDM0IsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7WUFDdkMsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDO1lBQ2hCLE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUU7Z0JBQzlCLE9BQU8sSUFBSSxHQUFHLENBQUM7Z0JBQ2YsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxXQUFXLEdBQUcsRUFBRSxFQUFFLENBQUM7b0JBQ3hDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDeEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztvQkFDekIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUM5QixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ2xCLENBQUM7cUJBQU0sSUFBSSxPQUFPLElBQUksU0FBUyxFQUFFLENBQUM7b0JBQzlCLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDeEIsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ3JELElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEMsQ0FBQztZQUNMLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNaLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVPLGNBQWM7UUFDbEIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUU7WUFDdEMsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ2YsSUFBSSxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsRUFBRSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDO3FCQUM5RCxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQywwQkFBMEIsRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuRixDQUFDO1FBQ0wsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ2QsQ0FBQztJQUVELEtBQUssQ0FBQyxXQUFXLENBQUMsTUFBYyxFQUFFLFNBQThCLEVBQUU7UUFDOUQsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDaEMsTUFBTSxJQUFJLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUNyQyxDQUFDO1FBRUQsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2pCLE1BQU0sT0FBTyxHQUFHO1lBQ1osTUFBTTtZQUNOLE1BQU07WUFDTixFQUFFLEVBQUUsSUFBSSxDQUFDLFNBQVM7WUFDbEIsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTO1NBQzFCLENBQUM7UUFFRixNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFFaEUsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztZQUN6QixHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQztZQUNyQixHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztZQUNwQixHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztZQUNuQixHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ04sR0FBRyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7WUFDcEIsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNOLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ25CLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDVCxDQUFDLENBQUM7UUFFSCxPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1lBQ25DLE1BQU0sT0FBTyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEVBQUU7Z0JBQzVCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUM3QyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsb0JBQW9CLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNwRCxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFFVixJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7Z0JBQ3RDLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFO29CQUNkLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDdEIsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNsQixDQUFDO2dCQUNELE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFO29CQUNaLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDdEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNoQixDQUFDO2FBQ0osQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLE1BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsS0FBSyxDQUFDLFVBQVUsQ0FBQyxTQUFpQixFQUFFLFFBQWdCLENBQUMsRUFBRSxTQUEyQixPQUFPO1FBQ3JGLE1BQU0sTUFBTSxHQUFHO1lBQ1gsT0FBTyxFQUFFLENBQUM7WUFDVixJQUFJLEVBQUUsU0FBUztZQUNmLElBQUksRUFBRSxNQUFNLEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEMsSUFBSSxFQUFFLE1BQU0sS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQyxJQUFJLEVBQUUsQ0FBQztZQUNQLElBQUksRUFBRSxDQUFDO1NBQ1YsQ0FBQztRQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDO1FBQzdELE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVELEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBaUIsRUFBRSxRQUFnQixDQUFDLEVBQUUsYUFBcUIsR0FBRztRQUN4RSxNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztRQUNqRCxNQUFNLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQzlELE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCxVQUFVO1FBQ04sSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDckIsSUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUN6QixhQUFhLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDdEMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQztRQUNsQyxDQUFDO1FBQ0QsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDZCxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ3ZCLENBQUM7SUFDTCxDQUFDO0lBRUQsV0FBVztRQUNQLE9BQU8sSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQztJQUNoRCxDQUFDO0NBQ0o7QUEzV0QsZ0NBMldDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgbmV0IGZyb20gJ25ldCc7XG5pbXBvcnQgKiBhcyBjcnlwdG8gZnJvbSAnY3J5cHRvJztcblxuLy8gVmFsaWQgRFZSSVAgcGFja2V0IHByZWZpeGVzXG5jb25zdCBEVlJJUF9IRUFERVJTID0gW1xuICAgIEJ1ZmZlci5mcm9tKFsweGEwLCAweDAwXSksICAvLyAzREVTIExvZ2luXG4gICAgQnVmZmVyLmZyb20oWzB4YTAsIDB4MDFdKSwgIC8vIERWUklQIFNlbmQgUmVxdWVzdCBSZWFsbVxuICAgIEJ1ZmZlci5mcm9tKFsweGEwLCAweDA1XSksICAvLyBEVlJJUCBsb2dpbiBTZW5kIExvZ2luIERldGFpbHNcbiAgICBCdWZmZXIuZnJvbShbMHhiMCwgMHgwMF0pLCAgLy8gRFZSSVAgUmVjZWl2ZVxuICAgIEJ1ZmZlci5mcm9tKFsweGIwLCAweDAxXSksICAvLyBEVlJJUCBSZWNlaXZlXG4gICAgQnVmZmVyLmZyb20oWzB4YTMsIDB4MDFdKSwgIC8vIERWUklQIERpc2NvdmVyIFJlcXVlc3RcbiAgICBCdWZmZXIuZnJvbShbMHhiMywgMHgwMF0pLCAgLy8gRFZSSVAgRGlzY292ZXIgUmVzcG9uc2VcbiAgICBCdWZmZXIuZnJvbShbMHhmNiwgMHgwMF0pLCAgLy8gRFZSSVAgSlNPTlxuXTtcblxuZnVuY3Rpb24gaXNEdnJpcFBhY2tldChkYXRhOiBCdWZmZXIpOiBib29sZWFuIHtcbiAgICBpZiAoZGF0YS5sZW5ndGggPCAyKSByZXR1cm4gZmFsc2U7XG4gICAgY29uc3QgcHJlZml4ID0gZGF0YS5zdWJhcnJheSgwLCAyKTtcbiAgICByZXR1cm4gRFZSSVBfSEVBREVSUy5zb21lKGggPT4gaC5lcXVhbHMocHJlZml4KSk7XG59XG5cbmZ1bmN0aW9uIHAzMih2YWx1ZTogbnVtYmVyLCBiaWdFbmRpYW4gPSBmYWxzZSk6IEJ1ZmZlciB7XG4gICAgY29uc3QgYnVmID0gQnVmZmVyLmFsbG9jKDQpO1xuICAgIGlmIChiaWdFbmRpYW4pIHtcbiAgICAgICAgYnVmLndyaXRlVUludDMyQkUodmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGJ1Zi53cml0ZVVJbnQzMkxFKHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ1Zjtcbn1cblxuZnVuY3Rpb24gdTMyKGRhdGE6IEJ1ZmZlciwgYmlnRW5kaWFuID0gZmFsc2UpOiBudW1iZXIge1xuICAgIGlmIChiaWdFbmRpYW4pIHtcbiAgICAgICAgcmV0dXJuIGRhdGEucmVhZFVJbnQzMkJFKDApO1xuICAgIH1cbiAgICByZXR1cm4gZGF0YS5yZWFkVUludDMyTEUoMCk7XG59XG5cbmZ1bmN0aW9uIHA2NCh2YWx1ZTogYmlnaW50LCBiaWdFbmRpYW4gPSBmYWxzZSk6IEJ1ZmZlciB7XG4gICAgY29uc3QgYnVmID0gQnVmZmVyLmFsbG9jKDgpO1xuICAgIGlmIChiaWdFbmRpYW4pIHtcbiAgICAgICAgYnVmLndyaXRlQmlnVUludDY0QkUodmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGJ1Zi53cml0ZUJpZ1VJbnQ2NExFKHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ1Zjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEVlJJUE9wdGlvbnMge1xuICAgIGhvc3Q6IHN0cmluZztcbiAgICBwb3J0PzogbnVtYmVyO1xuICAgIHVzZXJuYW1lOiBzdHJpbmc7XG4gICAgcGFzc3dvcmQ6IHN0cmluZztcbiAgICBjb25zb2xlPzogQ29uc29sZTtcbn1cblxuZXhwb3J0IGNsYXNzIERhaHVhRFZSSVAge1xuICAgIHByaXZhdGUgaG9zdDogc3RyaW5nO1xuICAgIHByaXZhdGUgcG9ydDogbnVtYmVyO1xuICAgIHByaXZhdGUgdXNlcm5hbWU6IHN0cmluZztcbiAgICBwcml2YXRlIHBhc3N3b3JkOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBzb2NrZXQ6IG5ldC5Tb2NrZXQgfCBudWxsID0gbnVsbDtcbiAgICBwcml2YXRlIHNlc3Npb25JZDogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIHJlcXVlc3RJZDogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIHJ1bm5pbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBwcml2YXRlIGtlZXBhbGl2ZUludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICAgIHByaXZhdGUgYnVmZmVyOiBCdWZmZXIgPSBCdWZmZXIuYWxsb2MoMCk7XG4gICAgcHJpdmF0ZSBwZW5kaW5nUmVzb2x2ZXJzOiBNYXA8bnVtYmVyLCB7IHJlc29sdmU6IChkYXRhOiBhbnkpID0+IHZvaWQ7IHJlamVjdDogKGVycjogRXJyb3IpID0+IHZvaWQgfT4gPSBuZXcgTWFwKCk7XG4gICAgcHJpdmF0ZSBjb25zb2xlOiBDb25zb2xlO1xuXG4gICAgY29uc3RydWN0b3Iob3B0aW9uczogRFZSSVBPcHRpb25zKSB7XG4gICAgICAgIHRoaXMuaG9zdCA9IG9wdGlvbnMuaG9zdDtcbiAgICAgICAgdGhpcy5wb3J0ID0gb3B0aW9ucy5wb3J0IHx8IDM3Nzc3O1xuICAgICAgICB0aGlzLnVzZXJuYW1lID0gb3B0aW9ucy51c2VybmFtZTtcbiAgICAgICAgdGhpcy5wYXNzd29yZCA9IG9wdGlvbnMucGFzc3dvcmQ7XG4gICAgICAgIHRoaXMuY29uc29sZSA9IG9wdGlvbnMuY29uc29sZSB8fCBjb25zb2xlO1xuICAgIH1cblxuICAgIHByaXZhdGUgZGFodWFHZW4xSGFzaChwYXNzd29yZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgbWQ1ID0gY3J5cHRvLmNyZWF0ZUhhc2goJ21kNScpO1xuICAgICAgICBtZDUudXBkYXRlKHBhc3N3b3JkLCAnbGF0aW4xJyk7XG4gICAgICAgIGNvbnN0IGRpZ2VzdCA9IG1kNS5kaWdlc3QoKTtcblxuICAgICAgICBjb25zdCBvdXQ6IG51bWJlcltdID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGlnZXN0Lmxlbmd0aDsgaSArPSAyKSB7XG4gICAgICAgICAgICBsZXQgdmFsID0gKGRpZ2VzdFtpXSArIGRpZ2VzdFtpICsgMV0pICUgNjI7XG4gICAgICAgICAgICBpZiAodmFsIDwgMTApIHtcbiAgICAgICAgICAgICAgICB2YWwgKz0gNDg7ICAvLyAnMCctJzknXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZhbCA8IDM2KSB7XG4gICAgICAgICAgICAgICAgdmFsICs9IDU1OyAgLy8gJ0EnLSdaJ1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWwgKz0gNjE7ICAvLyAnYSctJ3onXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvdXQucHVzaCh2YWwpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLm91dCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkYWh1YUdlbjJNZDVIYXNoKHJhbmRvbTogc3RyaW5nLCByZWFsbTogc3RyaW5nLCB1c2VybmFtZTogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgLy8gRmlyc3QgaGFzaDogdXNlcm5hbWU6cmVhbG06cGFzc3dvcmRcbiAgICAgICAgY29uc3QgcHdkZGJIYXNoID0gY3J5cHRvLmNyZWF0ZUhhc2goJ21kNScpXG4gICAgICAgICAgICAudXBkYXRlKGAke3VzZXJuYW1lfToke3JlYWxtfToke3Bhc3N3b3JkfWAsICdsYXRpbjEnKVxuICAgICAgICAgICAgLmRpZ2VzdCgnaGV4JylcbiAgICAgICAgICAgIC50b1VwcGVyQ2FzZSgpO1xuXG4gICAgICAgIC8vIFNlY29uZCBoYXNoOiB1c2VybmFtZTpyYW5kb206Zmlyc3RfaGFzaFxuICAgICAgICBjb25zdCByYW5kb21IYXNoID0gY3J5cHRvLmNyZWF0ZUhhc2goJ21kNScpXG4gICAgICAgICAgICAudXBkYXRlKGAke3VzZXJuYW1lfToke3JhbmRvbX06JHtwd2RkYkhhc2h9YCwgJ2xhdGluMScpXG4gICAgICAgICAgICAuZGlnZXN0KCdoZXgnKVxuICAgICAgICAgICAgLnRvVXBwZXJDYXNlKCk7XG5cbiAgICAgICAgcmV0dXJuIHJhbmRvbUhhc2g7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkYWh1YUR2cmlwTWQ1SGFzaChyYW5kb206IHN0cmluZywgdXNlcm5hbWU6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGdlbjFIYXNoID0gdGhpcy5kYWh1YUdlbjFIYXNoKHBhc3N3b3JkKTtcbiAgICAgICAgY29uc3QgcmFuZG9tSGFzaCA9IGNyeXB0by5jcmVhdGVIYXNoKCdtZDUnKVxuICAgICAgICAgICAgLnVwZGF0ZShgJHt1c2VybmFtZX06JHtyYW5kb219OiR7Z2VuMUhhc2h9YCwgJ2xhdGluMScpXG4gICAgICAgICAgICAuZGlnZXN0KCdoZXgnKVxuICAgICAgICAgICAgLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiByYW5kb21IYXNoO1xuICAgIH1cblxuICAgIHByaXZhdGUgYnVpbGREdnJpcEF1dGhIYXNoKHJhbmRvbTogc3RyaW5nLCByZWFsbTogc3RyaW5nLCB1c2VybmFtZTogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgZ2VuMiA9IHRoaXMuZGFodWFHZW4yTWQ1SGFzaChyYW5kb20sIHJlYWxtLCB1c2VybmFtZSwgcGFzc3dvcmQpO1xuICAgICAgICBjb25zdCBnZW4xID0gdGhpcy5kYWh1YUR2cmlwTWQ1SGFzaChyYW5kb20sIHVzZXJuYW1lLCBwYXNzd29yZCk7XG4gICAgICAgIHJldHVybiBgJHt1c2VybmFtZX0mJiR7Z2VuMn0ke2dlbjF9YDtcbiAgICB9XG5cbiAgICBhc3luYyBjb25uZWN0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zb2NrZXQgPSBuZXcgbmV0LlNvY2tldCgpO1xuICAgICAgICAgICAgdGhpcy5zb2NrZXQuc2V0VGltZW91dCgxMDAwMCk7XG5cbiAgICAgICAgICAgIHRoaXMuc29ja2V0Lm9uKCdjb25uZWN0JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucnVubmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25zb2xlLmxvZyhgW0RWUklQXSBDb25uZWN0ZWQgdG8gJHt0aGlzLmhvc3R9OiR7dGhpcy5wb3J0fWApO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnNvY2tldC5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25zb2xlLmVycm9yKGBbRFZSSVBdIFNvY2tldCBlcnJvcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnNvY2tldC5vbigndGltZW91dCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoJ1tEVlJJUF0gU29ja2V0IHRpbWVvdXQnKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNvY2tldD8uZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ0Nvbm5lY3Rpb24gdGltZW91dCcpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnNvY2tldC5vbignZGF0YScsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVEYXRhKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuc29ja2V0Lm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnNvbGUubG9nKCdbRFZSSVBdIENvbm5lY3Rpb24gY2xvc2VkJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5zb2NrZXQuY29ubmVjdCh0aGlzLnBvcnQsIHRoaXMuaG9zdCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRGF0YShkYXRhOiBCdWZmZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5idWZmZXIgPSBCdWZmZXIuY29uY2F0KFt0aGlzLmJ1ZmZlciwgZGF0YV0pO1xuICAgICAgICB0aGlzLnByb2Nlc3NCdWZmZXIoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHByb2Nlc3NCdWZmZXIoKTogdm9pZCB7XG4gICAgICAgIHdoaWxlICh0aGlzLmJ1ZmZlci5sZW5ndGggPj0gMzIpIHtcbiAgICAgICAgICAgIGlmIChpc0R2cmlwUGFja2V0KHRoaXMuYnVmZmVyKSkge1xuICAgICAgICAgICAgICAgIC8vIFBhcnNlIGhlYWRlciB0byBnZXQgZXhwZWN0ZWQgZGF0YSBsZW5ndGhcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhTGVuID0gdGhpcy5idWZmZXIucmVhZFVJbnQzMkxFKDQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsTGVuID0gMzIgKyBkYXRhTGVuO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYnVmZmVyLmxlbmd0aCA+PSB0b3RhbExlbikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYWNrZXQgPSB0aGlzLmJ1ZmZlci5zdWJhcnJheSgwLCB0b3RhbExlbik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyID0gdGhpcy5idWZmZXIuc3ViYXJyYXkodG90YWxMZW4pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVBhY2tldChwYWNrZXQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyAgLy8gTmVlZCBtb3JlIGRhdGFcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE5vdCBhIERWUklQIHBhY2tldCAtIHNraXAgYnl0ZXMgdW50aWwgd2UgZmluZCBvbmVcbiAgICAgICAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuYnVmZmVyLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPSB0aGlzLmJ1ZmZlci5zdWJhcnJheShpLCBpICsgMik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChEVlJJUF9IRUFERVJTLnNvbWUoaCA9PiBoLmVxdWFscyhwcmVmaXgpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idWZmZXIgPSB0aGlzLmJ1ZmZlci5zdWJhcnJheShpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghZm91bmQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5idWZmZXIgPSB0aGlzLmJ1ZmZlci5zdWJhcnJheSgtMSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlUGFja2V0KHBhY2tldDogQnVmZmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGhlYWRlciA9IHBhY2tldC5zdWJhcnJheSgwLCAzMik7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBwYWNrZXQuc3ViYXJyYXkoMzIpO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYSBKU09OIHJlc3BvbnNlXG4gICAgICAgIGlmIChoZWFkZXJbMF0gPT09IDB4ZjYgfHwgaGVhZGVyWzBdID09PSAweGIwKSB7XG4gICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGRhdGEudG9TdHJpbmcoJ2xhdGluMScpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBqc29uU3RhcnQgPSB0ZXh0LmluZGV4T2YoJ3snKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QganNvbkVuZCA9IHRleHQubGFzdEluZGV4T2YoJ30nKSArIDE7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqc29uU3RhcnQgPj0gMCAmJiBqc29uRW5kID4ganNvblN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBqc29uRGF0YSA9IEpTT04ucGFyc2UodGV4dC5zdWJzdHJpbmcoanNvblN0YXJ0LCBqc29uRW5kKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpZCA9IGpzb25EYXRhLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkICYmIHRoaXMucGVuZGluZ1Jlc29sdmVycy5oYXMoaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzb2x2ZXIgPSB0aGlzLnBlbmRpbmdSZXNvbHZlcnMuZ2V0KGlkKSE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nUmVzb2x2ZXJzLmRlbGV0ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIucmVzb2x2ZShqc29uRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE5vdCBKU09OIG9yIHBhcnNlIGVycm9yXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgbG9naW4oKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIGlmICghdGhpcy5zb2NrZXQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm90IGNvbm5lY3RlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3RlcCAxOiBTZW5kIHJlYWxtIHJlcXVlc3RcbiAgICAgICAgY29uc3QgaW5pdEhlYWRlciA9IEJ1ZmZlci5mcm9tKFtcbiAgICAgICAgICAgIDB4YTAsIDB4MDEsIDB4MDAsIDB4MDAsXG4gICAgICAgICAgICAweDAwLCAweDAwLCAweDAwLCAweDAwLFxuICAgICAgICAgICAgMHgwMCwgMHgwMCwgMHgwMCwgMHgwMCxcbiAgICAgICAgICAgIDB4MDAsIDB4MDAsIDB4MDAsIDB4MDAsXG4gICAgICAgICAgICAweDAwLCAweDAwLCAweDAwLCAweDAwLFxuICAgICAgICAgICAgMHgwMCwgMHgwMCwgMHgwMCwgMHgwMCxcbiAgICAgICAgICAgIDB4MDUsIDB4MDIsIDB4MDEsIDB4MDEsXG4gICAgICAgICAgICAweDAwLCAweDAwLCAweGExLCAweGFhXG4gICAgICAgIF0pO1xuXG4gICAgICAgIHRoaXMuY29uc29sZS5sb2coJ1tEVlJJUF0gU2VuZGluZyBsb2dpbiByZXF1ZXN0Li4uJyk7XG4gICAgICAgIHRoaXMuc29ja2V0LndyaXRlKGluaXRIZWFkZXIpO1xuXG4gICAgICAgIC8vIFdhaXQgZm9yIGNoYWxsZW5nZSByZXNwb25zZVxuICAgICAgICBjb25zdCBjaGFsbGVuZ2VEYXRhID0gYXdhaXQgdGhpcy53YWl0Rm9yRGF0YSg1MDAwKTtcbiAgICAgICAgaWYgKCFjaGFsbGVuZ2VEYXRhIHx8IGNoYWxsZW5nZURhdGEubGVuZ3RoIDwgMzIpIHtcbiAgICAgICAgICAgIHRoaXMuY29uc29sZS5lcnJvcignW0RWUklQXSBObyBjaGFsbGVuZ2UgcmVzcG9uc2UnKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGNoYWxsZW5nZURhdGEuc3ViYXJyYXkoMzIpLnRvU3RyaW5nKCdsYXRpbjEnKTtcbiAgICAgICAgbGV0IHJlYWxtOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICAgICAgbGV0IHJhbmRvbTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIHJlc3BvbnNlVGV4dC5zcGxpdCgnXFxuJykpIHtcbiAgICAgICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJ1JlYWxtOicpKSB7XG4gICAgICAgICAgICAgICAgcmVhbG0gPSBsaW5lLnN1YnN0cmluZyg2KS50cmltKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGxpbmUuc3RhcnRzV2l0aCgnUmFuZG9tOicpKSB7XG4gICAgICAgICAgICAgICAgcmFuZG9tID0gbGluZS5zdWJzdHJpbmcoNykudHJpbSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZWFsbSB8fCAhcmFuZG9tKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoJ1tEVlJJUF0gRmFpbGVkIHRvIHBhcnNlIGNoYWxsZW5nZScpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jb25zb2xlLmxvZyhgW0RWUklQXSBSZWFsbTogJHtyZWFsbX0sIFJhbmRvbTogJHtyYW5kb219YCk7XG5cbiAgICAgICAgLy8gU3RlcCAyOiBTZW5kIGF1dGhlbnRpY2F0aW9uXG4gICAgICAgIGNvbnN0IGF1dGhTdHJpbmcgPSB0aGlzLmJ1aWxkRHZyaXBBdXRoSGFzaChyYW5kb20sIHJlYWxtLCB0aGlzLnVzZXJuYW1lLCB0aGlzLnBhc3N3b3JkKTtcbiAgICAgICAgY29uc3QgYXV0aERhdGEgPSBCdWZmZXIuZnJvbShhdXRoU3RyaW5nLCAnbGF0aW4xJyk7XG5cbiAgICAgICAgY29uc3QgYXV0aEhlYWRlciA9IEJ1ZmZlci5jb25jYXQoW1xuICAgICAgICAgICAgcDMyKDB4YTAwNTAwMDAsIHRydWUpLFxuICAgICAgICAgICAgcDMyKGF1dGhEYXRhLmxlbmd0aCksXG4gICAgICAgICAgICBCdWZmZXIuYWxsb2MoMTYpLFxuICAgICAgICAgICAgcDY0KDB4MDUwMjAwMDgwMDAwYTFhYW4sIHRydWUpXG4gICAgICAgIF0pO1xuXG4gICAgICAgIHRoaXMuY29uc29sZS5sb2coJ1tEVlJJUF0gU2VuZGluZyBhdXRoZW50aWNhdGlvbi4uLicpO1xuICAgICAgICB0aGlzLnNvY2tldC53cml0ZShCdWZmZXIuY29uY2F0KFthdXRoSGVhZGVyLCBhdXRoRGF0YV0pKTtcblxuICAgICAgICAvLyBXYWl0IGZvciBhdXRoIHJlc3BvbnNlXG4gICAgICAgIGNvbnN0IGF1dGhSZXNwb25zZSA9IGF3YWl0IHRoaXMud2FpdEZvckRhdGEoNTAwMCk7XG4gICAgICAgIGlmICghYXV0aFJlc3BvbnNlIHx8IGF1dGhSZXNwb25zZS5sZW5ndGggPCAzMikge1xuICAgICAgICAgICAgdGhpcy5jb25zb2xlLmVycm9yKCdbRFZSSVBdIE5vIGF1dGggcmVzcG9uc2UnKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGVycm9yQ29kZSA9IGF1dGhSZXNwb25zZS5zdWJhcnJheSg4LCAxMCk7XG4gICAgICAgIGlmIChlcnJvckNvZGVbMF0gPT09IDB4MDAgJiYgZXJyb3JDb2RlWzFdID09PSAweDA4KSB7XG4gICAgICAgICAgICB0aGlzLnNlc3Npb25JZCA9IGF1dGhSZXNwb25zZS5yZWFkVUludDMyTEUoMTYpO1xuICAgICAgICAgICAgdGhpcy5jb25zb2xlLmxvZyhgW0RWUklQXSBMb2dpbiBzdWNjZXNzZnVsISBTZXNzaW9uIElEOiAke3RoaXMuc2Vzc2lvbklkfWApO1xuICAgICAgICAgICAgdGhpcy5zdGFydEtlZXBhbGl2ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNvbnNvbGUuZXJyb3IoYFtEVlJJUF0gTG9naW4gZmFpbGVkIHdpdGggZXJyb3IgY29kZTogJHtlcnJvckNvZGUudG9TdHJpbmcoJ2hleCcpfWApO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB3YWl0Rm9yRGF0YSh0aW1lb3V0TXM6IG51bWJlcik6IFByb21pc2U8QnVmZmVyIHwgbnVsbD4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0QnVmZmVyID0gdGhpcy5idWZmZXIubGVuZ3RoO1xuICAgICAgICAgICAgbGV0IGVsYXBzZWQgPSAwO1xuICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgZWxhcHNlZCArPSAxMDA7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYnVmZmVyLmxlbmd0aCA+IHN0YXJ0QnVmZmVyICsgMzIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmJ1ZmZlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5idWZmZXIgPSBCdWZmZXIuYWxsb2MoMCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbGFwc2VkID49IHRpbWVvdXRNcykge1xuICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0aGlzLmJ1ZmZlci5sZW5ndGggPiAwID8gdGhpcy5idWZmZXIgOiBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5idWZmZXIgPSBCdWZmZXIuYWxsb2MoMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGFydEtlZXBhbGl2ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5rZWVwYWxpdmVJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnJ1bm5pbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmRDb21tYW5kKCdnbG9iYWwua2VlcEFsaXZlJywgeyB0aW1lb3V0OiAzMCwgYWN0aXZlOiB0cnVlIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gdGhpcy5jb25zb2xlLmVycm9yKCdbRFZSSVBdIEtlZXBhbGl2ZSBlcnJvcjonLCBlcnIubWVzc2FnZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAyNTAwMCk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2VuZENvbW1hbmQobWV0aG9kOiBzdHJpbmcsIHBhcmFtczogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgaWYgKCF0aGlzLnNvY2tldCB8fCAhdGhpcy5ydW5uaW5nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBjb25uZWN0ZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVxdWVzdElkKys7XG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSB7XG4gICAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICBpZDogdGhpcy5yZXF1ZXN0SWQsXG4gICAgICAgICAgICBzZXNzaW9uOiB0aGlzLnNlc3Npb25JZFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGpzb25EYXRhID0gQnVmZmVyLmZyb20oSlNPTi5zdHJpbmdpZnkoY29tbWFuZCksICdsYXRpbjEnKTtcblxuICAgICAgICBjb25zdCBoZWFkZXIgPSBCdWZmZXIuY29uY2F0KFtcbiAgICAgICAgICAgIHAzMigweGY2MDAwMDAwLCB0cnVlKSxcbiAgICAgICAgICAgIHAzMihqc29uRGF0YS5sZW5ndGgpLFxuICAgICAgICAgICAgcDMyKHRoaXMucmVxdWVzdElkKSxcbiAgICAgICAgICAgIHAzMigwKSxcbiAgICAgICAgICAgIHAzMihqc29uRGF0YS5sZW5ndGgpLFxuICAgICAgICAgICAgcDMyKDApLFxuICAgICAgICAgICAgcDMyKHRoaXMuc2Vzc2lvbklkKSxcbiAgICAgICAgICAgIHAzMigwKVxuICAgICAgICBdKTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ1Jlc29sdmVycy5kZWxldGUodGhpcy5yZXF1ZXN0SWQpO1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoYENvbW1hbmQgdGltZW91dDogJHttZXRob2R9YCkpO1xuICAgICAgICAgICAgfSwgMTAwMDApO1xuXG4gICAgICAgICAgICB0aGlzLnBlbmRpbmdSZXNvbHZlcnMuc2V0KHRoaXMucmVxdWVzdElkLCB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZTogKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVqZWN0OiAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuc29ja2V0IS53cml0ZShCdWZmZXIuY29uY2F0KFtoZWFkZXIsIGpzb25EYXRhXSkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBhc3luYyBwdHpDb250cm9sKGRpcmVjdGlvbjogc3RyaW5nLCBzcGVlZDogbnVtYmVyID0gNSwgYWN0aW9uOiAnc3RhcnQnIHwgJ3N0b3AnID0gJ3N0YXJ0Jyk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgICAgIGNoYW5uZWw6IDAsXG4gICAgICAgICAgICBjb2RlOiBkaXJlY3Rpb24sXG4gICAgICAgICAgICBhcmcxOiBhY3Rpb24gPT09ICdzdGFydCcgPyBzcGVlZCA6IDAsXG4gICAgICAgICAgICBhcmcyOiBhY3Rpb24gPT09ICdzdGFydCcgPyBzcGVlZCA6IDAsXG4gICAgICAgICAgICBhcmczOiAwLFxuICAgICAgICAgICAgYXJnNDogMFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IG1ldGhvZCA9IGFjdGlvbiA9PT0gJ3N0YXJ0JyA/ICdwdHouc3RhcnQnIDogJ3B0ei5zdG9wJztcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VuZENvbW1hbmQobWV0aG9kLCBwYXJhbXMpO1xuICAgIH1cblxuICAgIGFzeW5jIHB0ek1vdmUoZGlyZWN0aW9uOiBzdHJpbmcsIHNwZWVkOiBudW1iZXIgPSA1LCBkdXJhdGlvbk1zOiBudW1iZXIgPSA1MDApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5wdHpDb250cm9sKGRpcmVjdGlvbiwgc3BlZWQsICdzdGFydCcpO1xuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZHVyYXRpb25NcykpO1xuICAgICAgICBhd2FpdCB0aGlzLnB0ekNvbnRyb2woZGlyZWN0aW9uLCAwLCAnc3RvcCcpO1xuICAgIH1cblxuICAgIGRpc2Nvbm5lY3QoKTogdm9pZCB7XG4gICAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5rZWVwYWxpdmVJbnRlcnZhbCkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmtlZXBhbGl2ZUludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMua2VlcGFsaXZlSW50ZXJ2YWwgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNvY2tldCkge1xuICAgICAgICAgICAgdGhpcy5zb2NrZXQuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5zb2NrZXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaXNDb25uZWN0ZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnJ1bm5pbmcgJiYgdGhpcy5zb2NrZXQgIT09IG51bGw7XG4gICAgfVxufVxuIl19","module.exports = require(\"net\");","module.exports = require(\"@scrypted/sdk\");","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst sdk_1 = __importStar(require(\"@scrypted/sdk\"));\nconst dvrip_1 = require(\"./dvrip\");\nconst { deviceManager, mediaManager } = sdk_1.default;\nclass AmcrestASH21Camera extends sdk_1.ScryptedDeviceBase {\n    constructor(nativeId) {\n        super(nativeId);\n        this.dvrip = null;\n        this.dvripConnecting = null;\n        // PTZ Capabilities\n        this.ptzCapabilities = {\n            pan: true,\n            tilt: true,\n            zoom: true,\n        };\n    }\n    getHost() {\n        return this.storage.getItem('host') || '';\n    }\n    getUsername() {\n        return this.storage.getItem('username') || 'admin';\n    }\n    getPassword() {\n        return this.storage.getItem('password') || '';\n    }\n    getRtspPort() {\n        return parseInt(this.storage.getItem('rtspPort') || '554');\n    }\n    getDvripPort() {\n        return parseInt(this.storage.getItem('dvripPort') || '37777');\n    }\n    getRtspUrl(subtype = 0) {\n        const host = this.getHost();\n        const username = encodeURIComponent(this.getUsername());\n        const password = encodeURIComponent(this.getPassword());\n        const port = this.getRtspPort();\n        return `rtsp://${username}:${password}@${host}:${port}/cam/realmonitor?channel=1&subtype=${subtype}`;\n    }\n    async getSettings() {\n        return [\n            {\n                key: 'host',\n                title: 'Camera IP Address',\n                value: this.getHost(),\n                type: 'string',\n                placeholder: '192.168.1.100',\n            },\n            {\n                key: 'username',\n                title: 'Username',\n                value: this.getUsername(),\n                type: 'string',\n            },\n            {\n                key: 'password',\n                title: 'Password',\n                value: this.getPassword(),\n                type: 'password',\n            },\n            {\n                key: 'rtspPort',\n                title: 'RTSP Port',\n                value: this.getRtspPort().toString(),\n                type: 'number',\n                placeholder: '554',\n            },\n            {\n                key: 'dvripPort',\n                title: 'DVRIP Port (for PTZ)',\n                value: this.getDvripPort().toString(),\n                type: 'number',\n                placeholder: '37777',\n            },\n        ];\n    }\n    async putSetting(key, value) {\n        this.storage.setItem(key, value != null ? String(value) : '');\n        // Disconnect DVRIP on settings change\n        if (this.dvrip) {\n            this.dvrip.disconnect();\n            this.dvrip = null;\n        }\n    }\n    async ensureDvripConnected() {\n        if (this.dvrip?.isConnected()) {\n            return this.dvrip;\n        }\n        if (this.dvripConnecting) {\n            await this.dvripConnecting;\n            if (this.dvrip?.isConnected()) {\n                return this.dvrip;\n            }\n        }\n        this.dvripConnecting = (async () => {\n            const host = this.getHost();\n            if (!host) {\n                throw new Error('Camera IP not configured');\n            }\n            this.dvrip = new dvrip_1.DahuaDVRIP({\n                host,\n                port: this.getDvripPort(),\n                username: this.getUsername(),\n                password: this.getPassword(),\n                console: this.console,\n            });\n            try {\n                await this.dvrip.connect();\n                const success = await this.dvrip.login();\n                return success;\n            }\n            catch (e) {\n                this.dvrip.disconnect();\n                this.dvrip = null;\n                throw e;\n            }\n        })();\n        const success = await this.dvripConnecting;\n        this.dvripConnecting = null;\n        if (!success) {\n            throw new Error('DVRIP login failed');\n        }\n        return this.dvrip;\n    }\n    // VideoCamera interface\n    async getVideoStream(options) {\n        const subtype = options?.id === 'substream' ? 1 : 0;\n        const rtspUrl = this.getRtspUrl(subtype);\n        const ffmpegInput = {\n            url: rtspUrl,\n            inputArguments: [\n                '-rtsp_transport', 'tcp',\n                '-i', rtspUrl,\n            ],\n        };\n        return mediaManager.createFFmpegMediaObject(ffmpegInput);\n    }\n    async getVideoStreamOptions() {\n        return [\n            {\n                id: 'mainstream',\n                name: 'Main Stream',\n                video: {\n                    codec: 'h264',\n                },\n                audio: {\n                    codec: 'aac',\n                },\n            },\n            {\n                id: 'substream',\n                name: 'Sub Stream',\n                video: {\n                    codec: 'h264',\n                },\n                audio: {\n                    codec: 'aac',\n                },\n            },\n        ];\n    }\n    // Camera interface\n    async takePicture(options) {\n        // Use FFmpeg to grab a frame from RTSP\n        const rtspUrl = this.getRtspUrl(1); // Use substream for faster snapshot\n        const ffmpegInput = {\n            url: rtspUrl,\n            inputArguments: [\n                '-rtsp_transport', 'tcp',\n                '-i', rtspUrl,\n                '-frames:v', '1',\n                '-f', 'image2',\n            ],\n        };\n        return mediaManager.createFFmpegMediaObject(ffmpegInput);\n    }\n    async getPictureOptions() {\n        return [];\n    }\n    // PanTiltZoom interface\n    async ptzCommand(command) {\n        const dvrip = await this.ensureDvripConnected();\n        // Map normalized values (-1 to 1) to DVRIP commands\n        // Speed is derived from magnitude\n        const getSpeed = (value) => {\n            if (value === undefined)\n                return 0;\n            return Math.min(8, Math.max(1, Math.ceil(Math.abs(value) * 8)));\n        };\n        const pan = command.pan;\n        const tilt = command.tilt;\n        const zoom = command.zoom;\n        try {\n            // Handle pan\n            if (pan !== undefined && pan !== 0) {\n                const direction = pan > 0 ? 'Right' : 'Left';\n                const speed = getSpeed(pan);\n                await dvrip.ptzControl(direction, speed, 'start');\n                // Stop after brief movement for relative control\n                setTimeout(async () => {\n                    try {\n                        await dvrip.ptzControl(direction, 0, 'stop');\n                    }\n                    catch (e) {\n                        // Ignore stop errors\n                    }\n                }, 200);\n            }\n            // Handle tilt\n            if (tilt !== undefined && tilt !== 0) {\n                const direction = tilt > 0 ? 'Up' : 'Down';\n                const speed = getSpeed(tilt);\n                await dvrip.ptzControl(direction, speed, 'start');\n                setTimeout(async () => {\n                    try {\n                        await dvrip.ptzControl(direction, 0, 'stop');\n                    }\n                    catch (e) {\n                        // Ignore stop errors\n                    }\n                }, 200);\n            }\n            // Handle zoom\n            if (zoom !== undefined && zoom !== 0) {\n                const direction = zoom > 0 ? 'ZoomIn' : 'ZoomOut';\n                const speed = getSpeed(zoom);\n                await dvrip.ptzControl(direction, speed, 'start');\n                setTimeout(async () => {\n                    try {\n                        await dvrip.ptzControl(direction, 0, 'stop');\n                    }\n                    catch (e) {\n                        // Ignore stop errors\n                    }\n                }, 200);\n            }\n        }\n        catch (e) {\n            this.console.error('PTZ command error:', e.message);\n            throw e;\n        }\n    }\n}\nclass AmcrestASH21Provider extends sdk_1.ScryptedDeviceBase {\n    constructor(nativeId) {\n        super(nativeId);\n        this.cameras = new Map();\n    }\n    async getSettings() {\n        return [\n            {\n                key: 'addCamera',\n                title: 'Add Camera',\n                description: 'Enter the camera IP address to add a new Amcrest ASH21 camera',\n                type: 'string',\n                placeholder: '192.168.1.100',\n            },\n        ];\n    }\n    async putSetting(key, value) {\n        if (key === 'addCamera' && value) {\n            const ip = String(value);\n            await this.addCamera(ip);\n        }\n    }\n    async addCamera(ip) {\n        const nativeId = `amcrest-ash21-${ip.replace(/\\./g, '-')}`;\n        await deviceManager.onDeviceDiscovered({\n            nativeId,\n            name: `Amcrest ASH21 (${ip})`,\n            type: sdk_1.ScryptedDeviceType.Camera,\n            interfaces: [\n                sdk_1.ScryptedInterface.Camera,\n                sdk_1.ScryptedInterface.VideoCamera,\n                sdk_1.ScryptedInterface.PanTiltZoom,\n                sdk_1.ScryptedInterface.Settings,\n            ],\n        });\n        // Set default host after device is created\n        const device = await this.getDevice(nativeId);\n        if (device && device.storage) {\n            device.storage.setItem('host', ip);\n        }\n    }\n    async getDevice(nativeId) {\n        let camera = this.cameras.get(nativeId);\n        if (!camera) {\n            camera = new AmcrestASH21Camera(nativeId);\n            this.cameras.set(nativeId, camera);\n        }\n        return camera;\n    }\n    async releaseDevice(id, nativeId) {\n        const camera = this.cameras.get(nativeId);\n        if (camera) {\n            this.cameras.delete(nativeId);\n        }\n    }\n}\nexports.default = new AmcrestASH21Provider();\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEscURBa0J1QjtBQUN2QixtQ0FBcUM7QUFFckMsTUFBTSxFQUFFLGFBQWEsRUFBRSxZQUFZLEVBQUUsR0FBRyxhQUFHLENBQUM7QUFFNUMsTUFBTSxrQkFBbUIsU0FBUSx3QkFBa0I7SUFJL0MsWUFBWSxRQUFnQjtRQUN4QixLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7UUFKWixVQUFLLEdBQXNCLElBQUksQ0FBQztRQUNoQyxvQkFBZSxHQUE0QixJQUFJLENBQUM7UUFNeEQsbUJBQW1CO1FBQ25CLG9CQUFlLEdBQTRCO1lBQ3ZDLEdBQUcsRUFBRSxJQUFJO1lBQ1QsSUFBSSxFQUFFLElBQUk7WUFDVixJQUFJLEVBQUUsSUFBSTtTQUNiLENBQUM7SUFQRixDQUFDO0lBU08sT0FBTztRQUNYLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzlDLENBQUM7SUFFTyxXQUFXO1FBQ2YsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxPQUFPLENBQUM7SUFDdkQsQ0FBQztJQUVPLFdBQVc7UUFDZixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNsRCxDQUFDO0lBRU8sV0FBVztRQUNmLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFFTyxZQUFZO1FBQ2hCLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxD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LENBQUMsQ0FBQztRQUMxQyxJQUFJLE1BQU0sRUFBRSxDQUFDO1lBQ1QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEMsQ0FBQztJQUNMLENBQUM7Q0FDSjtBQUVELGtCQUFlLElBQUksb0JBQW9CLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzZGssIHtcbiAgICBDYW1lcmEsXG4gICAgRGV2aWNlUHJvdmlkZXIsXG4gICAgRkZtcGVnSW5wdXQsXG4gICAgTWVkaWFPYmplY3QsXG4gICAgTWVkaWFTdHJlYW1PcHRpb25zLFxuICAgIFBhblRpbHRab29tLFxuICAgIFBhblRpbHRab29tQ2FwYWJpbGl0aWVzLFxuICAgIFBhblRpbHRab29tQ29tbWFuZCxcbiAgICBSZXNwb25zZU1lZGlhU3RyZWFtT3B0aW9ucyxcbiAgICBSZXNwb25zZVBpY3R1cmVPcHRpb25zLFxuICAgIFNjcnlwdGVkRGV2aWNlQmFzZSxcbiAgICBTY3J5cHRlZERldmljZVR5cGUsXG4gICAgU2NyeXB0ZWRJbnRlcmZhY2UsXG4gICAgU2V0dGluZyxcbiAgICBTZXR0aW5ncyxcbiAgICBTZXR0aW5nVmFsdWUsXG4gICAgVmlkZW9DYW1lcmEsXG59IGZyb20gJ0BzY3J5cHRlZC9zZGsnO1xuaW1wb3J0IHsgRGFodWFEVlJJUCB9IGZyb20gJy4vZHZyaXAnO1xuXG5jb25zdCB7IGRldmljZU1hbmFnZXIsIG1lZGlhTWFuYWdlciB9ID0gc2RrO1xuXG5jbGFzcyBBbWNyZXN0QVNIMjFDYW1lcmEgZXh0ZW5kcyBTY3J5cHRlZERldmljZUJhc2UgaW1wbGVtZW50cyBDYW1lcmEsIFZpZGVvQ2FtZXJhLCBQYW5UaWx0Wm9vbSwgU2V0dGluZ3Mge1xuICAgIHByaXZhdGUgZHZyaXA6IERhaHVhRFZSSVAgfCBudWxsID0gbnVsbDtcbiAgICBwcml2YXRlIGR2cmlwQ29ubmVjdGluZzogUHJvbWlzZTxib29sZWFuPiB8IG51bGwgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IobmF0aXZlSWQ6IHN0cmluZykge1xuICAgICAgICBzdXBlcihuYXRpdmVJZCk7XG4gICAgfVxuXG4gICAgLy8gUFRaIENhcGFiaWxpdGllc1xuICAgIHB0ekNhcGFiaWxpdGllczogUGFuVGlsdFpvb21DYXBhYmlsaXRpZXMgPSB7XG4gICAgICAgIHBhbjogdHJ1ZSxcbiAgICAgICAgdGlsdDogdHJ1ZSxcbiAgICAgICAgem9vbTogdHJ1ZSxcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBnZXRIb3N0KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2UuZ2V0SXRlbSgnaG9zdCcpIHx8ICcnO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0VXNlcm5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5nZXRJdGVtKCd1c2VybmFtZScpIHx8ICdhZG1pbic7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQYXNzd29yZCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5zdG9yYWdlLmdldEl0ZW0oJ3Bhc3N3b3JkJykgfHwgJyc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRSdHNwUG9ydCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5zdG9yYWdlLmdldEl0ZW0oJ3J0c3BQb3J0JykgfHwgJzU1NCcpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RHZyaXBQb3J0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLnN0b3JhZ2UuZ2V0SXRlbSgnZHZyaXBQb3J0JykgfHwgJzM3Nzc3Jyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRSdHNwVXJsKHN1YnR5cGU6IG51bWJlciA9IDApOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBob3N0ID0gdGhpcy5nZXRIb3N0KCk7XG4gICAgICAgIGNvbnN0IHVzZXJuYW1lID0gZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuZ2V0VXNlcm5hbWUoKSk7XG4gICAgICAgIGNvbnN0IHBhc3N3b3JkID0gZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuZ2V0UGFzc3dvcmQoKSk7XG4gICAgICAgIGNvbnN0IHBvcnQgPSB0aGlzLmdldFJ0c3BQb3J0KCk7XG4gICAgICAgIHJldHVybiBgcnRzcDovLyR7dXNlcm5hbWV9OiR7cGFzc3dvcmR9QCR7aG9zdH06JHtwb3J0fS9jYW0vcmVhbG1vbml0b3I/Y2hhbm5lbD0xJnN1YnR5cGU9JHtzdWJ0eXBlfWA7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0U2V0dGluZ3MoKTogUHJvbWlzZTxTZXR0aW5nW10+IHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBrZXk6ICdob3N0JyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0NhbWVyYSBJUCBBZGRyZXNzJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5nZXRIb3N0KCksXG4gICAgICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICcxOTIuMTY4LjEuMTAwJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAga2V5OiAndXNlcm5hbWUnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnVXNlcm5hbWUnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdldFVzZXJuYW1lKCksXG4gICAgICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGtleTogJ3Bhc3N3b3JkJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ1Bhc3N3b3JkJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5nZXRQYXNzd29yZCgpLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdwYXNzd29yZCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGtleTogJ3J0c3BQb3J0JyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ1JUU1AgUG9ydCcsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ2V0UnRzcFBvcnQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnNTU0JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAga2V5OiAnZHZyaXBQb3J0JyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0RWUklQIFBvcnQgKGZvciBQVFopJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5nZXREdnJpcFBvcnQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnMzc3NzcnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICBhc3luYyBwdXRTZXR0aW5nKGtleTogc3RyaW5nLCB2YWx1ZTogU2V0dGluZ1ZhbHVlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRoaXMuc3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUgIT0gbnVsbCA/IFN0cmluZyh2YWx1ZSkgOiAnJyk7XG4gICAgICAgIC8vIERpc2Nvbm5lY3QgRFZSSVAgb24gc2V0dGluZ3MgY2hhbmdlXG4gICAgICAgIGlmICh0aGlzLmR2cmlwKSB7XG4gICAgICAgICAgICB0aGlzLmR2cmlwLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgIHRoaXMuZHZyaXAgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBlbnN1cmVEdnJpcENvbm5lY3RlZCgpOiBQcm9taXNlPERhaHVhRFZSSVA+IHtcbiAgICAgICAgaWYgKHRoaXMuZHZyaXA/LmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmR2cmlwO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZHZyaXBDb25uZWN0aW5nKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmR2cmlwQ29ubmVjdGluZztcbiAgICAgICAgICAgIGlmICh0aGlzLmR2cmlwPy5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZHZyaXA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmR2cmlwQ29ubmVjdGluZyA9IChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBob3N0ID0gdGhpcy5nZXRIb3N0KCk7XG4gICAgICAgICAgICBpZiAoIWhvc3QpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbWVyYSBJUCBub3QgY29uZmlndXJlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmR2cmlwID0gbmV3IERhaHVhRFZSSVAoe1xuICAgICAgICAgICAgICAgIGhvc3QsXG4gICAgICAgICAgICAgICAgcG9ydDogdGhpcy5nZXREdnJpcFBvcnQoKSxcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdGhpcy5nZXRVc2VybmFtZSgpLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLmdldFBhc3N3b3JkKCksXG4gICAgICAgICAgICAgICAgY29uc29sZTogdGhpcy5jb25zb2xlLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5kdnJpcC5jb25uZWN0KCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IHRoaXMuZHZyaXAubG9naW4oKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzcztcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmR2cmlwLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmR2cmlwID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSgpO1xuXG4gICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB0aGlzLmR2cmlwQ29ubmVjdGluZztcbiAgICAgICAgdGhpcy5kdnJpcENvbm5lY3RpbmcgPSBudWxsO1xuXG4gICAgICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEVlJJUCBsb2dpbiBmYWlsZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmR2cmlwITtcbiAgICB9XG5cbiAgICAvLyBWaWRlb0NhbWVyYSBpbnRlcmZhY2VcbiAgICBhc3luYyBnZXRWaWRlb1N0cmVhbShvcHRpb25zPzogTWVkaWFTdHJlYW1PcHRpb25zKTogUHJvbWlzZTxNZWRpYU9iamVjdD4ge1xuICAgICAgICBjb25zdCBzdWJ0eXBlID0gb3B0aW9ucz8uaWQgPT09ICdzdWJzdHJlYW0nID8gMSA6IDA7XG4gICAgICAgIGNvbnN0IHJ0c3BVcmwgPSB0aGlzLmdldFJ0c3BVcmwoc3VidHlwZSk7XG5cbiAgICAgICAgY29uc3QgZmZtcGVnSW5wdXQ6IEZGbXBlZ0lucHV0ID0ge1xuICAgICAgICAgICAgdXJsOiBydHNwVXJsLFxuICAgICAgICAgICAgaW5wdXRBcmd1bWVudHM6IFtcbiAgICAgICAgICAgICAgICAnLXJ0c3BfdHJhbnNwb3J0JywgJ3RjcCcsXG4gICAgICAgICAgICAgICAgJy1pJywgcnRzcFVybCxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIG1lZGlhTWFuYWdlci5jcmVhdGVGRm1wZWdNZWRpYU9iamVjdChmZm1wZWdJbnB1dCk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VmlkZW9TdHJlYW1PcHRpb25zKCk6IFByb21pc2U8UmVzcG9uc2VNZWRpYVN0cmVhbU9wdGlvbnNbXT4ge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiAnbWFpbnN0cmVhbScsXG4gICAgICAgICAgICAgICAgbmFtZTogJ01haW4gU3RyZWFtJyxcbiAgICAgICAgICAgICAgICB2aWRlbzoge1xuICAgICAgICAgICAgICAgICAgICBjb2RlYzogJ2gyNjQnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYXVkaW86IHtcbiAgICAgICAgICAgICAgICAgICAgY29kZWM6ICdhYWMnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiAnc3Vic3RyZWFtJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnU3ViIFN0cmVhbScsXG4gICAgICAgICAgICAgICAgdmlkZW86IHtcbiAgICAgICAgICAgICAgICAgICAgY29kZWM6ICdoMjY0JyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGF1ZGlvOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvZGVjOiAnYWFjJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICAvLyBDYW1lcmEgaW50ZXJmYWNlXG4gICAgYXN5bmMgdGFrZVBpY3R1cmUob3B0aW9ucz86IGFueSk6IFByb21pc2U8TWVkaWFPYmplY3Q+IHtcbiAgICAgICAgLy8gVXNlIEZGbXBlZyB0byBncmFiIGEgZnJhbWUgZnJvbSBSVFNQXG4gICAgICAgIGNvbnN0IHJ0c3BVcmwgPSB0aGlzLmdldFJ0c3BVcmwoMSk7ICAvLyBVc2Ugc3Vic3RyZWFtIGZvciBmYXN0ZXIgc25hcHNob3RcblxuICAgICAgICBjb25zdCBmZm1wZWdJbnB1dDogRkZtcGVnSW5wdXQgPSB7XG4gICAgICAgICAgICB1cmw6IHJ0c3BVcmwsXG4gICAgICAgICAgICBpbnB1dEFyZ3VtZW50czogW1xuICAgICAgICAgICAgICAgICctcnRzcF90cmFuc3BvcnQnLCAndGNwJyxcbiAgICAgICAgICAgICAgICAnLWknLCBydHNwVXJsLFxuICAgICAgICAgICAgICAgICctZnJhbWVzOnYnLCAnMScsXG4gICAgICAgICAgICAgICAgJy1mJywgJ2ltYWdlMicsXG4gICAgICAgICAgICBdLFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBtZWRpYU1hbmFnZXIuY3JlYXRlRkZtcGVnTWVkaWFPYmplY3QoZmZtcGVnSW5wdXQpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldFBpY3R1cmVPcHRpb25zKCk6IFByb21pc2U8UmVzcG9uc2VQaWN0dXJlT3B0aW9uc1tdPiB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICAvLyBQYW5UaWx0Wm9vbSBpbnRlcmZhY2VcbiAgICBhc3luYyBwdHpDb21tYW5kKGNvbW1hbmQ6IFBhblRpbHRab29tQ29tbWFuZCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBkdnJpcCA9IGF3YWl0IHRoaXMuZW5zdXJlRHZyaXBDb25uZWN0ZWQoKTtcblxuICAgICAgICAvLyBNYXAgbm9ybWFsaXplZCB2YWx1ZXMgKC0xIHRvIDEpIHRvIERWUklQIGNvbW1hbmRzXG4gICAgICAgIC8vIFNwZWVkIGlzIGRlcml2ZWQgZnJvbSBtYWduaXR1ZGVcbiAgICAgICAgY29uc3QgZ2V0U3BlZWQgPSAodmFsdWU6IG51bWJlciB8IHVuZGVmaW5lZCk6IG51bWJlciA9PiB7XG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuIDA7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oOCwgTWF0aC5tYXgoMSwgTWF0aC5jZWlsKE1hdGguYWJzKHZhbHVlKSAqIDgpKSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcGFuID0gY29tbWFuZC5wYW47XG4gICAgICAgIGNvbnN0IHRpbHQgPSBjb21tYW5kLnRpbHQ7XG4gICAgICAgIGNvbnN0IHpvb20gPSBjb21tYW5kLnpvb207XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEhhbmRsZSBwYW5cbiAgICAgICAgICAgIGlmIChwYW4gIT09IHVuZGVmaW5lZCAmJiBwYW4gIT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSBwYW4gPiAwID8gJ1JpZ2h0JyA6ICdMZWZ0JztcbiAgICAgICAgICAgICAgICBjb25zdCBzcGVlZCA9IGdldFNwZWVkKHBhbik7XG4gICAgICAgICAgICAgICAgYXdhaXQgZHZyaXAucHR6Q29udHJvbChkaXJlY3Rpb24sIHNwZWVkLCAnc3RhcnQnKTtcbiAgICAgICAgICAgICAgICAvLyBTdG9wIGFmdGVyIGJyaWVmIG1vdmVtZW50IGZvciByZWxhdGl2ZSBjb250cm9sXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBkdnJpcC5wdHpDb250cm9sKGRpcmVjdGlvbiwgMCwgJ3N0b3AnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIHN0b3AgZXJyb3JzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCAyMDApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBIYW5kbGUgdGlsdFxuICAgICAgICAgICAgaWYgKHRpbHQgIT09IHVuZGVmaW5lZCAmJiB0aWx0ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGlsdCA+IDAgPyAnVXAnIDogJ0Rvd24nO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNwZWVkID0gZ2V0U3BlZWQodGlsdCk7XG4gICAgICAgICAgICAgICAgYXdhaXQgZHZyaXAucHR6Q29udHJvbChkaXJlY3Rpb24sIHNwZWVkLCAnc3RhcnQnKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGR2cmlwLnB0ekNvbnRyb2woZGlyZWN0aW9uLCAwLCAnc3RvcCcpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgc3RvcCBlcnJvcnNcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIDIwMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEhhbmRsZSB6b29tXG4gICAgICAgICAgICBpZiAoem9vbSAhPT0gdW5kZWZpbmVkICYmIHpvb20gIT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSB6b29tID4gMCA/ICdab29tSW4nIDogJ1pvb21PdXQnO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNwZWVkID0gZ2V0U3BlZWQoem9vbSk7XG4gICAgICAgICAgICAgICAgYXdhaXQgZHZyaXAucHR6Q29udHJvbChkaXJlY3Rpb24sIHNwZWVkLCAnc3RhcnQnKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGR2cmlwLnB0ekNvbnRyb2woZGlyZWN0aW9uLCAwLCAnc3RvcCcpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgc3RvcCBlcnJvcnNcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIDIwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICAgICAgdGhpcy5jb25zb2xlLmVycm9yKCdQVFogY29tbWFuZCBlcnJvcjonLCBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgQW1jcmVzdEFTSDIxUHJvdmlkZXIgZXh0ZW5kcyBTY3J5cHRlZERldmljZUJhc2UgaW1wbGVtZW50cyBEZXZpY2VQcm92aWRlciwgU2V0dGluZ3Mge1xuICAgIHByaXZhdGUgY2FtZXJhczogTWFwPHN0cmluZywgQW1jcmVzdEFTSDIxQ2FtZXJhPiA9IG5ldyBNYXAoKTtcblxuICAgIGNvbnN0cnVjdG9yKG5hdGl2ZUlkPzogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKG5hdGl2ZUlkKTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRTZXR0aW5ncygpOiBQcm9taXNlPFNldHRpbmdbXT4ge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGtleTogJ2FkZENhbWVyYScsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdBZGQgQ2FtZXJhJyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0VudGVyIHRoZSBjYW1lcmEgSVAgYWRkcmVzcyB0byBhZGQgYSBuZXcgQW1jcmVzdCBBU0gyMSBjYW1lcmEnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnMTkyLjE2OC4xLjEwMCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdO1xuICAgIH1cblxuICAgIGFzeW5jIHB1dFNldHRpbmcoa2V5OiBzdHJpbmcsIHZhbHVlOiBTZXR0aW5nVmFsdWUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ2FkZENhbWVyYScgJiYgdmFsdWUpIHtcbiAgICAgICAgICAgIGNvbnN0IGlwID0gU3RyaW5nKHZhbHVlKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYWRkQ2FtZXJhKGlwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgYWRkQ2FtZXJhKGlwOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgbmF0aXZlSWQgPSBgYW1jcmVzdC1hc2gyMS0ke2lwLnJlcGxhY2UoL1xcLi9nLCAnLScpfWA7XG5cbiAgICAgICAgYXdhaXQgZGV2aWNlTWFuYWdlci5vbkRldmljZURpc2NvdmVyZWQoe1xuICAgICAgICAgICAgbmF0aXZlSWQsXG4gICAgICAgICAgICBuYW1lOiBgQW1jcmVzdCBBU0gyMSAoJHtpcH0pYCxcbiAgICAgICAgICAgIHR5cGU6IFNjcnlwdGVkRGV2aWNlVHlwZS5DYW1lcmEsXG4gICAgICAgICAgICBpbnRlcmZhY2VzOiBbXG4gICAgICAgICAgICAgICAgU2NyeXB0ZWRJbnRlcmZhY2UuQ2FtZXJhLFxuICAgICAgICAgICAgICAgIFNjcnlwdGVkSW50ZXJmYWNlLlZpZGVvQ2FtZXJhLFxuICAgICAgICAgICAgICAgIFNjcnlwdGVkSW50ZXJmYWNlLlBhblRpbHRab29tLFxuICAgICAgICAgICAgICAgIFNjcnlwdGVkSW50ZXJmYWNlLlNldHRpbmdzLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU2V0IGRlZmF1bHQgaG9zdCBhZnRlciBkZXZpY2UgaXMgY3JlYXRlZFxuICAgICAgICBjb25zdCBkZXZpY2UgPSBhd2FpdCB0aGlzLmdldERldmljZShuYXRpdmVJZCk7XG4gICAgICAgIGlmIChkZXZpY2UgJiYgZGV2aWNlLnN0b3JhZ2UpIHtcbiAgICAgICAgICAgIGRldmljZS5zdG9yYWdlLnNldEl0ZW0oJ2hvc3QnLCBpcCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBnZXREZXZpY2UobmF0aXZlSWQ6IHN0cmluZyk6IFByb21pc2U8QW1jcmVzdEFTSDIxQ2FtZXJhPiB7XG4gICAgICAgIGxldCBjYW1lcmEgPSB0aGlzLmNhbWVyYXMuZ2V0KG5hdGl2ZUlkKTtcbiAgICAgICAgaWYgKCFjYW1lcmEpIHtcbiAgICAgICAgICAgIGNhbWVyYSA9IG5ldyBBbWNyZXN0QVNIMjFDYW1lcmEobmF0aXZlSWQpO1xuICAgICAgICAgICAgdGhpcy5jYW1lcmFzLnNldChuYXRpdmVJZCwgY2FtZXJhKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2FtZXJhO1xuICAgIH1cblxuICAgIGFzeW5jIHJlbGVhc2VEZXZpY2UoaWQ6IHN0cmluZywgbmF0aXZlSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBjYW1lcmEgPSB0aGlzLmNhbWVyYXMuZ2V0KG5hdGl2ZUlkKTtcbiAgICAgICAgaWYgKGNhbWVyYSkge1xuICAgICAgICAgICAgdGhpcy5jYW1lcmFzLmRlbGV0ZShuYXRpdmVJZCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IG5ldyBBbWNyZXN0QVNIMjFQcm92aWRlcigpO1xuIl19","module.exports = require(\"crypto\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(927);\n"],"names":["ownKeys","__createBinding","this","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","getOwnPropertyNames","ar","prototype","hasOwnProperty","call","length","mod","result","i","exports","DahuaDVRIP","net","crypto","DVRIP_HEADERS","Buffer","from","isDvripPacket","data","prefix","subarray","some","h","equals","p32","bigEndian","buf","alloc","writeUInt32BE","writeUInt32LE","p64","writeBigUInt64BE","writeBigUInt64LE","constructor","options","socket","sessionId","requestId","running","keepaliveInterval","buffer","pendingResolvers","Map","host","port","username","password","console","dahuaGen1Hash","md5","createHash","update","digest","out","val","push","String","fromCharCode","dahuaGen2Md5Hash","random","realm","pwddbHash","toUpperCase","dahuaDvripMd5Hash","gen1Hash","buildDvripAuthHash","connect","Promise","resolve","reject","Socket","setTimeout","on","log","err","error","message","destroy","Error","handleData","concat","processBuffer","totalLen","readUInt32LE","packet","handlePacket","found","header","text","toString","jsonStart","indexOf","jsonEnd","lastIndexOf","jsonData","JSON","parse","substring","id","has","resolver","delete","e","login","initHeader","write","challengeData","waitForData","responseText","line","split","startsWith","trim","authString","authData","authHeader","authResponse","errorCode","startKeepalive","timeoutMs","startBuffer","elapsed","interval","setInterval","clearInterval","sendCommand","timeout","active","catch","method","params","command","session","stringify","set","clearTimeout","ptzControl","direction","speed","action","channel","code","arg1","arg2","arg3","arg4","ptzMove","durationMs","disconnect","isConnected","module","require","sdk_1","dvrip_1","deviceManager","mediaManager","default","AmcrestASH21Camera","ScryptedDeviceBase","nativeId","super","dvrip","dvripConnecting","ptzCapabilities","pan","tilt","zoom","getHost","storage","getItem","getUsername","getPassword","getRtspPort","parseInt","getDvripPort","getRtspUrl","subtype","encodeURIComponent","getSettings","key","title","type","placeholder","putSetting","setItem","ensureDvripConnected","success","getVideoStream","rtspUrl","ffmpegInput","url","inputArguments","createFFmpegMediaObject","getVideoStreamOptions","name","video","codec","audio","takePicture","getPictureOptions","ptzCommand","getSpeed","Math","min","max","ceil","abs","async","AmcrestASH21Provider","cameras","description","ip","addCamera","replace","onDeviceDiscovered","ScryptedDeviceType","Camera","interfaces","ScryptedInterface","VideoCamera","PanTiltZoom","Settings","device","getDevice","camera","releaseDevice","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"ignoreList":[],"sourceRoot":""}